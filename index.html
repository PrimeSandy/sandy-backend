<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- SEO Optimized -->
    <title>E-TRAX | Smart Expense Tracker</title>
    <meta charset="UTF-8" />
    <meta name="description" content="E-TRAX is a smart expense tracker to manage daily income and expenses with analytics, Firebase login, and secure cloud storage." />
    <meta name="keywords" content="expense tracker, budget app, money manager, finance tracker, E-TRAX, alphaprime" />
    <meta name="author" content="AlphaPrime" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index, follow" />

    <!-- Open Graph -->
    <meta property="og:title" content="E-TRAX | Smart Expense Tracker" />
    <meta property="og:description" content="Track your expenses smartly with E-TRAX. Secure, fast and simple expense tracking app." />
    <meta property="og:url" content="https://alphaprime.co.in" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://alphaprime.co.in/og-image.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="E-TRAX | Smart Expense Tracker">
    <meta name="twitter:description" content="Track expenses smartly with analytics & secure Firebase login.">
    <meta name="twitter:image" content="https://alphaprime.co.in/og-image.png">

    <!-- Favicon -->
    <link rel="canonical" href="https://alphaprime.co.in" />
    <link rel="icon" type="image/png" href="favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="E Trax" />
    <meta name="theme-color" content="#00bcd4">
    <link rel="manifest" href="site.webmanifest" />

    <!-- External Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "E-TRAX",
      "operatingSystem": "Web",
      "applicationCategory": "FinanceApplication",
      "description": "E-TRAX is a smart expense tracker to manage daily income and expenses securely.",
      "url": "https://alphaprime.co.in",
      "publisher": {
        "@type": "Organization",
        "name": "AlphaPrime",
        "url": "https://alphaprime.co.in"
      }
    }
    </script>

    <style>
    :root {
      /* Dark Theme (Default) - HIGH CONTRAST */
      --primary: #00bcd4;
      --primary-dark: #0097a7;
      --secondary: #ffcc00;
      --background: #0b0b0b;
      --card-bg: #1a1a1a;
      --text: #ffffff;
      --text-light: #f1f5f9;
      --text-muted: #cbd5e1;
      --border: rgba(255,255,255,0.2);
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --shadow: 0 10px 30px rgba(0,0,0,0.6);
      --gradient: linear-gradient(135deg, #00bcd4 0%, #0097a7 100%);
    }

    [data-theme="light"] {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --secondary: #dc2626;
      --background: #ffffff;
      --card-bg: #f8fafc;
      --text: #000000;
      --text-light: #1e293b;
      --text-muted: #475569;
      --border: rgba(0,0,0,0.15);
      --success: #059669;
      --warning: #d97706;
      --danger: #dc2626;
      --shadow: 0 10px 30px rgba(0,0,0,0.1);
      --gradient: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
    }

    [data-theme="professional"] {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --secondary: #f59e0b;
      --background: #0f172a;
      --card-bg: #1e293b;
      --text: #ffffff;
      --text-light: #e2e8f0;
      --text-muted: #94a3b8;
      --border: rgba(255,255,255,0.2);
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --shadow: 0 10px 30px rgba(0,0,0,0.5);
      --gradient: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    }

    * {
      box-sizing: border-box;
      transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, transform 0.3s ease;
    }

    body {
      background-color: var(--background);
      color: var(--text);
      min-height: 100vh;
      margin: 0;
      font-family: "Poppins", sans-serif;
      line-height: 1.6;
      font-weight: 500;
      overflow-x: hidden;
    }

    /* ---------- ENHANCED LOADING STATES ---------- */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(5px);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 99999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .loading-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    .loading-steps {
      color: var(--text);
      font-size: 1rem;
      font-weight: 600;
      text-align: center;
      margin-top: 15px;
      height: 24px;
    }

    .loading-step {
      opacity: 0;
      transform: translateY(10px);
      animation: stepFade 0.5s ease forwards;
    }

    @keyframes stepFade {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ---------- ENHANCED LOGIN CARD ---------- */
    .login-wrapper {
      display: flex;
      align-items: center; 
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
      background: linear-gradient(135deg, var(--background) 0%, var(--card-bg) 100%);
      position: relative;
      overflow: hidden;
    }

    .login-wrapper::before {
      content: '';
      position: absolute;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(0,188,212,0.1) 0%, transparent 70%);
      animation: pulse 15s infinite linear;
    }

    @keyframes pulse {
      0% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, -50%) scale(1.1); }
      100% { transform: translate(-50%, -50%) scale(1); }
    }

    .login-card {
      width: 100%;
      max-width: 460px;
      background: var(--card-bg);
      border-radius: 20px;
      box-shadow: var(--shadow);
      padding: 45px 35px;
      text-align: center;
      border: 1px solid var(--border);
      position: relative;
      z-index: 1;
    }

    .login-card h1 { 
      color: var(--primary); 
      margin-bottom: 10px; 
      font-size: 2.4rem; 
      font-weight: 700;
      letter-spacing: 1px;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .login-card p { 
      color: var(--text-light); 
      margin-bottom: 30px; 
      font-size: 1.1rem;
      font-weight: 500;
      line-height: 1.5;
    }

    .google-btn {
      display:flex; 
      align-items:center; 
      gap:12px; 
      justify-content:center;
      width:100%; 
      background: var(--text);
      color: var(--background);
      border-radius:12px; 
      padding:16px 20px;
      font-weight:600; 
      cursor:pointer; 
      border:none;
      box-shadow: 0 4px 15px rgba(2,6,23,0.4);
      transition: all 0.3s ease;
      font-size: 1rem;
      position: relative;
      overflow: hidden;
    }

    .google-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(2,6,23,0.5);
    }

    .google-btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    .google-btn .btn-text {
      transition: opacity 0.3s ease;
    }

    .google-btn.loading .btn-text {
      opacity: 0;
    }

    .google-btn .loading-dots {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      opacity: 0;
      transition: opacity 0.3s ease;
      font-weight: 600;
    }

    .google-btn.loading .loading-dots {
      opacity: 1;
    }

    .loading-dots:after {
      content: 'Connecting to Server';
      animation: loadingSteps 4s infinite;
    }

    @keyframes loadingSteps {
      0% { content: 'Connecting to Server'; }
      20% { content: 'Logging in'; }
      40% { content: 'Optimizing Function'; }
      60% { content: 'Checking Authorized User'; }
      80% { content: 'Finalizing Login'; }
      100% { content: 'Connecting to Server'; }
    }

    .google-btn img { 
      width:22px; 
      height:22px; 
      transition: transform 0.3s ease;
    }

    .google-btn:hover img {
      transform: scale(1.1);
    }

    .small-note { 
      color: var(--text-muted); 
      font-size:0.9rem; 
      margin-top:20px; 
      font-weight: 500;
      line-height: 1.4;
    }

    /* ---------- ENHANCED HEADER ---------- */
    header { 
      display: none;
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      padding: 15px 25px;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 2px 25px rgba(0,0,0,0.2);
    }

    header.visible {
      display: block;
      animation: slideDown 0.5s ease;
    }

    @keyframes slideDown {
      from { transform: translateY(-100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }

    .brand-section {
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .brand-section h1 {
      font-size: 1.6rem; 
      color: var(--primary); 
      font-weight: 800; 
      margin: 0;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .typing { 
      font-size: 0.95rem; 
      color: var(--secondary); 
      font-weight: 600;
      min-height: 1.2rem;
      position: relative;
      padding-left: 20px;
    }

    .typing::before {
      content: 'üìä';
      position: absolute;
      left: 0;
      top: 0;
    }

    .header-controls {
      display: flex;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    #userNameDisplay {
      color: var(--secondary);
      font-weight: 700;
      font-size: 1rem;
      background: rgba(255,204,0,0.1);
      padding: 6px 12px;
      border-radius: 8px;
      border: 1px solid rgba(255,204,0,0.3);
    }

    .theme-toggle {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 15px;
      color: var(--text);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      font-weight: 600;
      min-width: 100px;
      justify-content: center;
    }

    .theme-toggle:hover {
      background: var(--primary);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .nav-links a { 
      color: var(--text); 
      text-decoration:none; 
      font-weight:600; 
      transition:all 0.3s ease; 
      position: relative;
      padding: 8px 15px;
      border-radius: 8px;
      font-size: 0.95rem;
    }

    .nav-links a:hover { 
      color: var(--primary);
      background: rgba(0,188,212,0.1);
      transform: translateY(-2px);
    }

    .nav-links a i {
      margin-right: 6px;
    }

    #googleLogoutBtn {
      background: transparent; 
      border: 2px solid var(--danger); 
      color: var(--danger);
      font-weight:600; 
      border-radius:10px; 
      padding:10px 18px; 
      transition:all 0.3s ease;
      cursor: pointer;
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    #googleLogoutBtn:hover { 
      background:var(--danger); 
      color:white; 
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(239,68,68,0.3);
    }

    /* ---------- ENHANCED MAIN CONTENT ---------- */
    .container {
      padding: 25px 15px;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* ---------- ENHANCED CARDS ---------- */
    .card {
      background: var(--card-bg);
      border-radius: 16px;
      border: 1px solid var(--border);
      box-shadow: 0 8px 30px rgba(0,0,0,0.4);
      transition: all 0.3s ease;
      margin-bottom: 25px;
      color: var(--text);
      overflow: hidden;
    }

    .card:hover {
      box-shadow: 0 12px 35px rgba(0,0,0,0.5);
      transform: translateY(-3px);
    }

    .card-header {
      background: var(--gradient);
      border-bottom: none;
      padding: 20px 25px;
      border-radius: 16px 16px 0 0 !important;
      color: white;
      font-weight: 700;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-body {
      padding: 25px;
      color: var(--text);
    }

    /* ---------- ENHANCED EXPENSE CARDS FOR MOBILE ---------- */
    .expense-card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 16px;
      margin-bottom: 15px;
      overflow: hidden;
      position: relative;
    }

    .expense-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 5px;
      height: 100%;
      background: var(--gradient);
    }

    .expense-card .card-body {
      padding: 20px;
    }

    .expense-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 8px;
    }

    .expense-meta {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 0.9rem;
    }

    .expense-amount {
      color: var(--success);
      font-weight: 700;
      font-size: 1.2rem;
    }

    .expense-type {
      background: rgba(0,188,212,0.1);
      color: var(--primary);
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .expense-description {
      color: var(--text-light);
      font-size: 0.95rem;
      margin: 10px 0;
      line-height: 1.5;
    }

    .expense-date {
      color: var(--text-muted);
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .expense-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .expense-actions .btn {
      flex: 1;
      padding: 8px 12px;
      font-size: 0.9rem;
      border-radius: 10px;
    }

    /* ---------- ENHANCED BUDGET SECTION ---------- */
    #budgetCard { 
      display:none; 
    }

    .budget-progress-container {
      margin: 20px 0;
    }

    .budget-stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-weight: 600;
    }

    #budgetBar { 
      height: 25px; 
      border-radius:12px; 
      overflow:hidden; 
      background: var(--border);
      margin-top: 10px;
      position: relative;
    }

    #budgetBar .progress { 
      height:100%; 
      transition: width 0.5s ease;
    }

    .budget-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 5px;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .budget-alert {
      padding: 15px;
      border-radius: 12px;
      margin-top: 15px;
      font-weight: 600;
      text-align: center;
      animation: pulseAlert 2s infinite;
    }

    @keyframes pulseAlert {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }

    /* ---------- ENHANCED FORM ---------- */
    .form-control, .form-select {
      background: var(--card-bg);
      border: 2px solid var(--border);
      color: var(--text);
      border-radius: 12px;
      padding: 12px 18px;
      font-size: 1rem;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .form-control:focus, .form-select:focus {
      background: var(--card-bg);
      border-color: var(--primary);
      color: var(--text);
      box-shadow: 0 0 0 0.3rem rgba(0,188,212,0.25);
      transform: translateY(-1px);
    }

    .form-label {
      color: var(--text-light);
      font-weight: 600;
      margin-bottom: 10px;
      font-size: 1rem;
    }

    /* ---------- ENHANCED BUTTONS ---------- */
    .btn {
      border-radius: 12px;
      font-weight: 600;
      padding: 12px 25px;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    }

    .btn-primary {
      background: var(--gradient);
      color: white;
      border: none;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      color: white;
    }

    .btn-danger {
      background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
      color: white;
    }

    .btn-warning {
      background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
      color: white;
      font-weight: 600;
    }

    .btn-info {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
    }

    .btn-outline-danger {
      border: 2px solid var(--danger);
      color: var(--danger);
      background: transparent;
    }

    .btn-outline-danger:hover {
      background: var(--danger);
      color: white;
    }

    .btn-sm {
      padding: 8px 15px;
      font-size: 0.9rem;
    }

    /* ---------- ENHANCED MODALS ---------- */
    .modal-overlay {
      display:none; 
      position:fixed; 
      top:0; 
      left:0; 
      width:100%; 
      height:100%;
      background: rgba(0,0,0,0.9); 
      color: var(--text); 
      z-index:9999; 
      overflow:auto;
      padding:30px 15px; 
      box-sizing:border-box;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      max-width:800px; 
      margin:auto; 
      background: var(--card-bg); 
      padding:35px; 
      border-radius:24px; 
      box-shadow: 0 15px 40px rgba(0,0,0,0.6);
      animation: modalSlideUp 0.4s ease;
      border: 1px solid var(--border);
      color: var(--text);
    }

    @keyframes modalSlideUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .modal-content h2 { 
      color: var(--primary); 
      text-align:center; 
      margin-bottom:25px; 
      font-weight: 800;
      font-size: 2rem;
    }

    /* ---------- ENHANCED HISTORY TABLE ---------- */
    .history-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      margin-top: 20px;
      color: var(--text);
      border-radius: 12px;
      overflow: hidden;
    }

    .history-table th,
    .history-table td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid var(--border);
      color: var(--text);
      font-weight: 500;
    }

    .history-table th {
      background: var(--gradient);
      color: white;
      font-weight: 700;
      font-size: 1rem;
    }

    .history-table tr:hover {
      background: rgba(0,188,212,0.08);
    }

    .changes-list {
      font-size: 0.9rem;
    }

    .changes-list div {
      margin: 4px 0;
      padding: 6px 10px;
      border-radius: 8px;
      background: rgba(0,188,212,0.1);
      color: var(--text);
      font-weight: 500;
      border-left: 3px solid var(--primary);
    }

    /* ---------- ENHANCED MESSAGE BOX ---------- */
    #msgBox {
      position: fixed; 
      top: 30px; 
      right: 30px;
      background: var(--gradient);
      color: white; 
      padding: 16px 28px;
      border-radius: 14px; 
      display: none; 
      z-index: 9999;
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
      animation: slideInRight 0.4s ease;
      font-weight: 700;
      font-size: 1rem;
      border: none;
      max-width: 400px;
    }

    @keyframes slideInRight {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* ---------- ENHANCED FOOTER ---------- */
    footer {
      background: var(--card-bg);
      color: var(--text-muted);
      text-align:center; 
      padding:30px 20px; 
      border-top:2px solid var(--border);
      margin-top:50px; 
      font-size:0.95rem;
      font-weight: 500;
    }

    .footer-content {
      max-width: 600px;
      margin: 0 auto;
    }

    .blinking-name { 
      color: var(--primary); 
      animation: blink 2s infinite;
      font-weight: 800;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    footer a {
      color: var(--primary);
      text-decoration: none;
      transition: all 0.3s ease;
      font-weight: 600;
      padding: 5px;
      border-radius: 6px;
    }

    footer a:hover {
      color: var(--primary-dark);
      text-decoration: none;
      background: rgba(0,188,212,0.1);
    }

    /* ---------- ENHANCED RESPONSIVE DESIGN ---------- */
    @media (max-width: 768px) {
      .login-card {
        padding: 35px 25px;
        border-radius: 18px;
        margin: 15px;
      }
      
      .login-card h1 {
        font-size: 2rem;
      }
      
      .login-card p {
        font-size: 1rem;
      }
      
      .header-content {
        flex-direction: column;
        text-align: center;
        gap: 12px;
      }
      
      .brand-section {
        flex-direction: column;
        gap: 8px;
      }
      
      .header-controls {
        flex-direction: column;
        gap: 12px;
        width: 100%;
      }
      
      .nav-links {
        justify-content: center;
        flex-wrap: wrap;
        width: 100%;
      }
      
      .nav-links a {
        padding: 8px 12px;
        font-size: 0.9rem;
      }
      
      .card-header {
        padding: 18px 20px;
        font-size: 1rem;
      }
      
      .card-body {
        padding: 20px;
      }
      
      .expense-actions {
        flex-direction: column;
      }
      
      .expense-actions .btn {
        width: 100%;
      }
      
      #msgBox {
        top: 20px;
        right: 15px;
        left: 15px;
        max-width: none;
        text-align: center;
      }
      
      .modal-content {
        padding: 25px 20px;
        margin: 20px 15px;
      }
      
      .chart-container {
        height: 250px;
      }
      
      .google-btn {
        padding: 15px 18px;
      }
      
      .theme-toggle span {
        display: none;
      }
    }

    @media (max-width: 576px) {
      .container {
        padding: 20px 10px;
      }
      
      .login-wrapper {
        padding: 15px;
      }
      
      .login-card {
        padding: 30px 20px;
      }
      
      .btn {
        padding: 10px 20px;
        font-size: 0.95rem;
      }
      
      .form-control, .form-select {
        padding: 10px 15px;
        font-size: 1rem;
      }
      
      .expense-title {
        font-size: 1rem;
      }
      
      .expense-amount {
        font-size: 1.1rem;
      }
      
      .header-controls {
        flex-direction: column;
        align-items: stretch;
      }
      
      #userNameDisplay {
        text-align: center;
        margin-bottom: 5px;
      }
      
      .nav-links {
        justify-content: space-between;
      }
      
      .nav-links a {
        flex: 1;
        text-align: center;
        padding: 10px 5px;
        font-size: 0.85rem;
      }
    }

    @media (min-width: 769px) and (max-width: 1200px) {
      .container {
        padding: 30px 20px;
      }
      
      .card {
        margin-bottom: 20px;
      }
    }

    /* ---------- ENHANCED CHART CONTAINERS ---------- */
    .chart-container {
      position: relative;
      height: 320px;
      margin-bottom: 25px;
      background: var(--card-bg);
      border-radius: 16px;
      padding: 20px;
      border: 1px solid var(--border);
    }

    /* ---------- ENHANCED BADGES ---------- */
    .badge {
      padding: 8px 15px;
      border-radius: 25px;
      font-size: 0.85rem;
      font-weight: 700;
      color: white;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }

    .badge-success {
      background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
      color: white;
    }

    .badge-warning {
      background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
      color: white;
    }

    .badge-danger {
      background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
      color: white;
    }

    .badge-info {
      background: var(--gradient);
      color: white;
    }

    /* ---------- ENHANCED TABLE RESPONSIVENESS ---------- */
    .table-responsive {
      border-radius: 16px;
      overflow: hidden;
      background: var(--card-bg);
      border: 1px solid var(--border);
      margin-top: 20px;
    }

    .table {
      color: var(--text) !important;
      margin-bottom: 0;
    }

    .table thead th {
      background: var(--gradient);
      color: white;
      font-weight: 700;
      padding: 18px 15px;
      border: none;
    }

    .table tbody td {
      padding: 15px;
      vertical-align: middle;
      border-color: var(--border);
      font-weight: 500;
    }

    .table tbody tr:hover {
      background: rgba(0,188,212,0.08);
    }

    /* Force horizontal scroll on mobile */
    @media (max-width: 768px) {
      .table-responsive {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      
      .table {
        min-width: 650px;
      }
      
      .table thead th,
      .table tbody td {
        padding: 12px 8px;
        font-size: 0.9rem;
      }
      
      .btn-group .btn-sm {
        padding: 6px 10px;
        font-size: 0.8rem;
      }
    }

    /* ---------- ENHANCED TEXT STYLES ---------- */
    .text-muted {
      color: var(--text-muted) !important;
      font-weight: 500;
    }

    .high-contrast-text {
      color: var(--text) !important;
      font-weight: 700 !important;
    }

    /* ---------- ENHANCED GRID SYSTEM ---------- */
    .row {
      margin-bottom: 20px;
    }

    .row.g-3 {
      --bs-gutter-x: 1rem;
      --bs-gutter-y: 1rem;
    }

    /* ---------- UTILITY CLASSES ---------- */
    .fade-in {
      animation: fadeIn 0.5s ease;
    }

    .slide-up {
      animation: slideUp 0.5s ease;
    }

    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    /* ---------- SCROLLBAR STYLING ---------- */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }

    ::-webkit-scrollbar-track {
      background: var(--card-bg);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary-dark);
    }
    .seo-h1 {
  position: absolute;
  left: -9999px;
  top: auto;
  width: 1px;
  height: 1px;
  overflow: hidden;
}

    </style>
  </head>

  <body>
    <h1 class="seo-h1">
  E-TRAX ‚Äì Smart Expense Tracker App
</h1>

    <!-- LOADING OVERLAY -->
    <div id="loadingOverlay" class="loading-overlay">
      <div class="loading-spinner"></div>
      <div class="loading-steps" id="loadingSteps"></div>
    </div>

    <!-- LOGIN VIEW -->
    <div id="loginView" class="login-wrapper">
      <div class="login-card fade-in">
        <h2 class="project-name">E-TRAX</h2>
        <p>Track expenses ‚Äî smarter. Sign in with Google to continue.</p>

        <button id="googleLoginBtn" class="google-btn" aria-label="Login with Google">
          <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google">
          <span class="btn-text">Sign in with Google</span>
          <span class="loading-dots"></span>
        </button>

        <div class="small-note">We only use Google to authenticate you ‚Äî no payment info required.</div>
        <div style="margin-top:20px;">
          <small style="color:var(--text-muted)">Developed by <strong style="color:var(--primary)">ALPHA DEVELOPERS </strong></small>
        </div>
      </div>
    </div>

    <!-- HEADER -->
    <header id="mainHeader">
      <div class="header-content">
        <div class="brand-section">
          <h2 class="project-name">E-TRAX</h2>
          <div class="typing" id="typingHeader"></div>
        </div>
        
        <div class="header-controls">
          <div id="userNameDisplay"></div>
          
          <button class="theme-toggle" id="themeToggle">
            <i class="fas fa-palette"></i>
            <span>Theme</span>
          </button>
          
          <nav class="nav-links">
            <a href="https://whatsapp.com/channel/0029Va5gnd0CcW4xKICHcb0k" target="_blank" rel="noopener">
              <i class="fas fa-phone"></i> Contact
            </a>
            <a href="#" id="aboutLink">
              <i class="fas fa-info-circle"></i> About
            </a>
            <a href="#" id="historyLink">
              <i class="fas fa-history"></i> History
            </a>
            <button id="googleLogoutBtn">
              <i class="fas fa-sign-out-alt"></i> Logout
            </button>
          </nav>
        </div>
      </div>
    </header>

    <!-- MAIN CONTAINER -->
    <div class="container my-3">
      <!-- BUDGET CARD -->
      <div id="budgetCard" class="card slide-up">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
              <h5 style="margin:0;color:var(--warning);">
                <i class="fas fa-wallet"></i> Budget Limit
              </h5>
              <small class="text-muted">Set a monthly/total budget for your expenses</small>
            </div>
            <div>
              <button id="resetBudgetBtn" class="btn btn-outline-danger btn-sm">
                <i class="fas fa-redo"></i> Reset Budget
              </button>
            </div>
          </div>

          <div class="row g-2 mb-3">
            <div class="col-md-5">
              <input type="number" id="budgetInput" class="form-control" placeholder="Enter budget amount (e.g. 5000)" min="1">
            </div>
            <div class="col-md-3">
              <button id="saveBudgetBtn" class="btn btn-primary w-100">
                <i class="fas fa-save"></i> Save Budget
              </button>
            </div>
            <div class="col-md-4 text-end">
              <div id="budgetStatusText" style="font-weight:600;color:var(--text);">
                <i class="fas fa-info-circle"></i> No budget set
              </div>
            </div>
          </div>

          <div class="budget-progress-container">
            <div class="budget-stats">
              <span id="budgetSpent">Spent: ‚Çπ0.00</span>
              <span id="budgetRemaining">Remaining: ‚Çπ0.00</span>
            </div>
            <div id="budgetBar" class="mb-2">
              <div id="budgetProgress" class="progress" style="width:100%">
                <div id="budgetProgressBar" class="progress-bar" role="progressbar" style="width:0%"></div>
              </div>
            </div>
            <div class="budget-labels">
              <span>0%</span>
              <span id="budgetPercentage">0%</span>
              <span>100%</span>
            </div>
          </div>

          <div id="budgetAlerts" style="min-height:22px;"></div>
        </div>
      </div>

      <!-- EXPENSE FORM -->
      <div id="expenseFormContainer" style="display:none;">
        <div class="card slide-up">
          <div class="card-header">
            <h5 class="mb-0"><i class="fas fa-plus-circle"></i> Add New Expense</h5>
          </div>
          <div class="card-body">
            <form id="expenseForm" class="row g-3">
              <input type="hidden" id="editId">
              <div class="col-md-6">
                <label for="name" class="form-label">Name</label>
                <input type="text" id="name" class="form-control" required placeholder="e.g., Grocery Shopping">
              </div>
              <div class="col-md-6">
                <label for="amount" class="form-label">Amount (‚Çπ)</label>
                <input type="number" id="amount" class="form-control" required min="1" step="0.01" placeholder="e.g., 500.50">
              </div>
              <div class="col-md-6">
                <label for="type" class="form-label">Payment Type</label>
                <select id="type" class="form-select" required>
                  <option value="">Choose one...</option>
                  <option value="Card">Card</option>
                  <option value="Cash">Cash</option>
                  <option value="Gpay/Paytm">Gpay/Paytm</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <div class="col-md-6">
                <label for="description" class="form-label">Description</label>
                <input type="text" id="description" class="form-control" required placeholder="e.g., Weekly grocery purchase">
              </div>
              <div class="col-md-6">
                <label for="date" class="form-label">Date</label>
                <input type="date" id="date" class="form-control" required>
              </div>
              <div class="col-12 d-flex justify-content-between mt-3">
                <button type="reset" class="btn btn-danger">
                  <i class="fas fa-times"></i> Clear
                </button>
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-check"></i> Confirm
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- EXPENSES CONTAINER -->
      <div id="expensesContainer">
        <!-- Will be populated dynamically -->
      </div>

      <!-- ANALYTICS -->
      <div id="analyticsContainer" class="my-4" style="display:none;">
        <div class="card slide-up">
          <div class="card-header">
            <h5 class="mb-0"><i class="fas fa-chart-bar"></i> Expense Analytics</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <div class="chart-container">
                  <canvas id="lineChart"></canvas>
                </div>
              </div>
              <div class="col-md-6">
                <div class="chart-container">
                  <canvas id="pieChart"></canvas>
                </div>
                <div id="analyticsBadge" class="text-center mt-3"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ABOUT MODAL -->
    <div id="aboutModal" class="modal-overlay">
      <div class="modal-content">
        <h2>About E-TRAX</h2>
        <p><strong>E-TRAX</strong> helps you <strong>track your daily expenses</strong> and manage your budget efficiently.</p>
        <h4><i class="fas fa-lightbulb"></i> Purpose</h4>
        <p>Record, categorize, and analyze your spending patterns easily.</p>
        <h4><i class="fas fa-cogs"></i> How It Works</h4>
        <ul>
          <li>Add expenses with name, amount, and date.</li>
          <li>View and edit them anytime.</li>
          <li>Check total expenses instantly.</li>
          <li>See visual analytics of your spending trends.</li>
          <li>Set budget limits and track your spending against them.</li>
          <li>Track complete edit history with user details.</li>
        </ul>
        <div style="text-align:center;">
          <button id="closeAbout" class="btn btn-primary">Close</button>
        </div>
      </div>
    </div>

    <!-- HISTORY MODAL -->
    <div id="historyModal" class="modal-overlay">
      <div class="modal-content">
        <h2><i class="fas fa-history"></i> Edit History</h2>
        <div id="historyContent">
          <p>Loading history...</p>
        </div>
        <div style="text-align:center; margin-top: 20px;">
          <button id="closeHistory" class="btn btn-primary">Close</button>
        </div>
      </div>
    </div>

    <!-- MESSAGE BOX -->
    <div id="msgBox"></div>

    <script>
    // ==================== ENHANCED LOADING SYSTEM ====================
    const loadingSteps = [
      "Connecting to Server...",
      "Logging in...",
      "Optimizing Function...",
      "Checking Authorized User...",
      "Finalizing Login...",
      "Almost Done..."
    ];

    function showLoading(message = "") {
      const overlay = document.getElementById('loadingOverlay');
      const stepsElement = document.getElementById('loadingSteps');
      
      if (message) {
        stepsElement.textContent = message;
      }
      
      overlay.classList.add('active');
    }

    function hideLoading() {
      const overlay = document.getElementById('loadingOverlay');
      overlay.classList.remove('active');
      document.getElementById('loadingSteps').textContent = "";
    }

    function animateLoadingSteps() {
      const stepsElement = document.getElementById('loadingSteps');
      let stepIndex = 0;
      
      const interval = setInterval(() => {
        if (!document.getElementById('loadingOverlay').classList.contains('active')) {
          clearInterval(interval);
          return;
        }
        
        stepsElement.innerHTML = `<span class="loading-step">${loadingSteps[stepIndex]}</span>`;
        stepIndex = (stepIndex + 1) % loadingSteps.length;
      }, 800);
      
      return interval;
    }

    // ==================== CONFIGURATION ====================
    const BASE_URL = window.location.hostname.includes("localhost")
      ? "http://localhost:3000"
      : "https://sandy-backend2-0.onrender.com";

    let auth = null;
    let currentUserUid = null;
    let currentUserName = null;

    // ==================== ENHANCED THEME MANAGEMENT ====================
    const themes = ['dark', 'light', 'professional'];
    let currentThemeIndex = 0;

    function initTheme() {
      const savedTheme = localStorage.getItem('theme') || 'dark';
      currentThemeIndex = themes.indexOf(savedTheme);
      applyTheme(savedTheme);
    }

    function applyTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
      
      // Update theme button text
      const themeToggle = document.getElementById('themeToggle');
      if (themeToggle) {
        themeToggle.innerHTML = `
          <i class="fas fa-palette"></i>
          <span>${theme.charAt(0).toUpperCase() + theme.slice(1)}</span>
        `;
      }
    }

    function cycleTheme() {
      currentThemeIndex = (currentThemeIndex + 1) % themes.length;
      applyTheme(themes[currentThemeIndex]);
      showMessage(`Theme changed to ${themes[currentThemeIndex]}`, 2000);
    }

    // ==================== ENHANCED FIREBASE INITIALIZATION ====================
    async function initializeFirebase() {
      try {
        showLoading("Initializing app...");
        const response = await fetch(`${BASE_URL}/firebase-config`);
        const firebaseConfig = await response.json();
        
        if (!firebaseConfig.apiKey) {
          throw new Error('Firebase config not available');
        }
        
        firebase.initializeApp(firebaseConfig);
        auth = firebase.auth();
        console.log('Firebase initialized securely');
        
        // Initialize auth state listener
        setupAuthListener();
        hideLoading();
        
      } catch (error) {
        console.error('Failed to initialize Firebase:', error);
        hideLoading();
        showMessage('‚ùå Failed to initialize app. Please refresh.', 5000);
      }
    }

    function setupAuthListener() {
      auth.onAuthStateChanged(user => {
        if (user) {
          currentUserUid = user.uid;
          currentUserName = user.displayName || "User";
          toggleLoginState(true);
          loadData();
          userNameDisplay.textContent = currentUserName;
          fetchBudget();
          
          // Pre-fill today's date in form
          const today = new Date().toISOString().split('T')[0];
          const dateInput = document.getElementById('date');
          if (dateInput && !dateInput.value) {
            dateInput.value = today;
          }
        } else {
          currentUserUid = null;
          currentUserName = null;
          toggleLoginState(false);
          clearExpensesUI();
          analyticsContainer.style.display = "none";
          userNameDisplay.textContent = "";
          clearBudgetUI();
        }
      });
    }

    // ==================== ENHANCED ELEMENT SELECTORS ====================
    const elements = {
      loginBtn: document.getElementById("googleLoginBtn"),
      logoutBtn: document.getElementById("googleLogoutBtn"),
      loginView: document.getElementById("loginView"),
      mainHeader: document.getElementById("mainHeader"),
      expenseFormContainer: document.getElementById("expenseFormContainer"),
      expensesContainer: document.getElementById("expensesContainer"),
      msgBox: document.getElementById("msgBox"),
      userNameDisplay: document.getElementById("userNameDisplay"),
      analyticsContainer: document.getElementById("analyticsContainer"),
      themeToggle: document.getElementById("themeToggle"),
      historyLink: document.getElementById("historyLink"),
      historyModal: document.getElementById("historyModal"),
      closeHistory: document.getElementById("closeHistory"),
      historyContent: document.getElementById("historyContent"),
      aboutLink: document.getElementById("aboutLink"),
      aboutModal: document.getElementById("aboutModal"),
      closeAbout: document.getElementById("closeAbout"),
      budgetCard: document.getElementById("budgetCard"),
      budgetInput: document.getElementById("budgetInput"),
      saveBudgetBtn: document.getElementById("saveBudgetBtn"),
      resetBudgetBtn: document.getElementById("resetBudgetBtn"),
      budgetProgressBar: document.getElementById("budgetProgressBar"),
      budgetStatusText: document.getElementById("budgetStatusText"),
      budgetAlerts: document.getElementById("budgetAlerts"),
      analyticsBadge: document.getElementById("analyticsBadge"),
      form: document.getElementById("expenseForm"),
      editId: document.getElementById("editId"),
      budgetSpent: document.getElementById("budgetSpent"),
      budgetRemaining: document.getElementById("budgetRemaining"),
      budgetPercentage: document.getElementById("budgetPercentage")
    };

    // ==================== ENHANCED MESSAGE SYSTEM ====================
    function showMessage(msg, duration = 3000) {
      elements.msgBox.innerText = msg;
      elements.msgBox.style.display = "block";
      
      // Add appropriate icon based on message type
      if (msg.includes('‚úÖ') || msg.includes('success')) {
        elements.msgBox.style.background = "linear-gradient(135deg, var(--success) 0%, #059669 100%)";
      } else if (msg.includes('‚ùå') || msg.includes('failed') || msg.includes('error')) {
        elements.msgBox.style.background = "linear-gradient(135deg, var(--danger) 0%, #dc2626 100%)";
      } else if (msg.includes('‚ö†Ô∏è') || msg.includes('warning')) {
        elements.msgBox.style.background = "linear-gradient(135deg, var(--warning) 0%, #d97706 100%)";
      } else {
        elements.msgBox.style.background = "var(--gradient)";
      }
      
      setTimeout(() => {
        elements.msgBox.style.display = "none";
      }, duration);
    }

    // ==================== ENHANCED LOGIN/LOGOUT ====================
    elements.loginBtn?.addEventListener("click", async () => {
      if (!auth) {
        showMessage("‚ùå App not ready. Please wait...", 2000);
        return;
      }
      
      // Show loading state on button
      elements.loginBtn.disabled = true;
      elements.loginBtn.classList.add('loading');
      
      const loadingInterval = animateLoadingSteps();
      showLoading();
      
      const provider = new firebase.auth.GoogleAuthProvider();
      
      try {
        const result = await auth.signInWithPopup(provider);
        currentUserUid = result.user.uid;
        currentUserName = result.user.displayName || "User";
        toggleLoginState(true);
        loadData();
        elements.userNameDisplay.textContent = currentUserName;
        showMessage("‚úÖ Logged in successfully", 2000);
        fetchBudget();
      } catch(err) { 
        console.error(err); 
        showMessage("‚ùå Login failed. Please try again.", 2000); 
      } finally {
        clearInterval(loadingInterval);
        hideLoading();
        elements.loginBtn.disabled = false;
        elements.loginBtn.classList.remove('loading');
      }
    });

    elements.logoutBtn?.addEventListener("click", async () => {
      if (!auth) return;
      
      if (!confirm("Are you sure you want to logout?")) return;
      
      try {
        showLoading("Logging out...");
        await auth.signOut();
        currentUserUid = null;
        currentUserName = null;
        toggleLoginState(false);
        clearExpensesUI();
        elements.analyticsContainer.style.display = "none";
        elements.userNameDisplay.textContent = "";
        clearBudgetUI();
        showMessage("‚úÖ Logged out successfully", 2000);
      } catch(err) { 
        console.error(err); 
        showMessage("‚ùå Logout failed", 2000); 
      } finally {
        hideLoading();
      }
    });

    // ==================== ENHANCED TOGGLE LOGIN STATE ====================
    function toggleLoginState(isLoggedIn) {
      elements.loginView.style.display = isLoggedIn ? "none" : "flex";
      elements.mainHeader.classList.toggle('visible', isLoggedIn);
      elements.expenseFormContainer.style.display = isLoggedIn ? "block" : "none";
      elements.budgetCard.style.display = isLoggedIn ? "block" : "none";
    }

    // ==================== ENHANCED TYPING ANIMATION ====================
    const headerText = "Track Your Expenses Smartly!";
    const typingHeader = document.getElementById("typingHeader");
    let headerIndex = 0;
    let typingInterval;

    function typeWriterHeader() {
      if (headerIndex < headerText.length) {
        typingHeader.innerHTML += headerText.charAt(headerIndex);
        headerIndex++;
        typingInterval = setTimeout(typeWriterHeader, 100);
      } else {
        setTimeout(() => { 
          typingHeader.innerHTML = ""; 
          headerIndex = 0; 
          typeWriterHeader(); 
        }, 3000);
      }
    }

    // ==================== ENHANCED EXPENSE FORM ====================
    elements.form?.addEventListener("submit", async e => {
      e.preventDefault();
      if (!currentUserUid) return;
      
      const data = {
        uid: currentUserUid,
        name: document.getElementById("name").value.trim(),
        amount: parseFloat(document.getElementById("amount").value).toFixed(2),
        type: document.getElementById("type").value,
        description: document.getElementById("description").value.trim(),
        date: document.getElementById("date").value
      };
      
      // Validate data
      if (!data.name || !data.amount || !data.type || !data.description || !data.date) {
        showMessage("‚ùå Please fill all fields correctly", 2000);
        return;
      }
      
      if (parseFloat(data.amount) <= 0) {
        showMessage("‚ùå Amount must be greater than 0", 2000);
        return;
      }
      
      try {
        showLoading(elements.editId.value ? "Updating expense..." : "Adding expense...");
        
        const url = elements.editId.value ? `${BASE_URL}/update/${elements.editId.value}` : `${BASE_URL}/submit`;
        const method = elements.editId.value ? "PUT" : "POST";
        
        if (elements.editId.value) {
          data.editorName = currentUserName;
        }
        
        const res = await fetch(url, { 
          method, 
          headers: { "Content-Type": "application/json" }, 
          body: JSON.stringify(data)
        });
        
        const result = await res.json();
        
        if (res.ok) {
          showMessage(elements.editId.value ? "‚úÖ Expense updated successfully" : "‚úÖ Expense added successfully");
          elements.editId.value = "";
          elements.form.reset();
          
          // Reset date to today
          const today = new Date().toISOString().split('T')[0];
          document.getElementById('date').value = today;
          
          await loadData();
          await fetchBudget();
        } else {
          showMessage(result.message || "‚ùå Operation failed", 2500);
        }
      } catch(err) { 
        console.error(err); 
        showMessage("‚ùå Network error. Please try again.", 2500);
      } finally {
        hideLoading();
      }
    });

    // Add cancel edit button dynamically
    function setupEditCancelButton() {
      const formActions = elements.form?.querySelector('.col-12');
      if (!formActions) return;
      
      // Remove existing cancel button if any
      const existingCancel = formActions.querySelector('#cancelEditBtn');
      if (existingCancel) existingCancel.remove();
      
      if (elements.editId.value) {
        const cancelBtn = document.createElement('button');
        cancelBtn.type = 'button';
        cancelBtn.id = 'cancelEditBtn';
        cancelBtn.className = 'btn btn-warning';
        cancelBtn.innerHTML = '<i class="fas fa-times"></i> Cancel Edit';
        cancelBtn.onclick = () => {
          elements.editId.value = "";
          elements.form.reset();
          const today = new Date().toISOString().split('T')[0];
          document.getElementById('date').value = today;
          showMessage("‚úè Edit cancelled", 2000);
          cancelBtn.remove();
        };
        
        formActions.insertBefore(cancelBtn, formActions.children[1]);
      }
    }

    // ==================== ENHANCED BUDGET FUNCTIONS ====================
    let currentBudgetAmount = 0;

    async function saveBudgetToServer(amount) {
      if (!currentUserUid) return;
      
      try {
        showLoading("Saving budget...");
        const res = await fetch(`${BASE_URL}/setBudget`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ 
            uid: currentUserUid, 
            amount: parseFloat(amount) || 0 
          })
        });
        
        const r = await res.json();
        
        if (res.ok) {
          showMessage(r.message || "‚úÖ Budget saved successfully");
          await fetchBudget();
        } else {
          showMessage(r.message || "‚ùå Failed to save budget");
        }
      } catch(err) { 
        console.error(err); 
        showMessage("‚ùå Network error. Please try again.", 2000);
      } finally {
        hideLoading();
      }
    }

    async function fetchBudget() {
      if (!currentUserUid) {
        clearBudgetUI();
        return;
      }
      
      try {
        const res = await fetch(`${BASE_URL}/getBudget?uid=${currentUserUid}`);
        if (!res.ok) {
          clearBudgetUI();
          return;
        }
        
        const r = await res.json();
        if (!r || typeof r.amount === "undefined" || r.amount === 0) {
          currentBudgetAmount = 0;
          clearBudgetUI();
          return;
        }
        
        currentBudgetAmount = parseFloat(r.amount) || 0;
        const expensesRes = await fetch(`${BASE_URL}/users?uid=${currentUserUid}`);
        const arr = await expensesRes.json();
        
        let totalAmount = 0;
        if (Array.isArray(arr)) {
          arr.forEach(x => totalAmount += parseFloat(x.amount) || 0);
        }
        
        updateBudgetUI(currentBudgetAmount, totalAmount);
        if (elements.budgetInput) {
          elements.budgetInput.value = currentBudgetAmount;
        }
      } catch(err) { 
        console.error(err); 
        clearBudgetUI();
      }
    }

    function clearBudgetUI() {
      if (elements.budgetInput) elements.budgetInput.value = "";
      if (elements.budgetProgressBar) {
        elements.budgetProgressBar.style.width = "0%";
        elements.budgetProgressBar.textContent = "";
      }
      if (elements.budgetStatusText) {
        elements.budgetStatusText.innerHTML = '<i class="fas fa-info-circle"></i> No budget set';
      }
      if (elements.budgetAlerts) elements.budgetAlerts.innerHTML = "";
      if (elements.budgetSpent) elements.budgetSpent.textContent = "Spent: ‚Çπ0.00";
      if (elements.budgetRemaining) elements.budgetRemaining.textContent = "Remaining: ‚Çπ0.00";
      if (elements.budgetPercentage) elements.budgetPercentage.textContent = "0%";
      if (elements.analyticsBadge) elements.analyticsBadge.innerHTML = "";
      
      currentBudgetAmount = 0;
    }

    function updateBudgetUI(budgetAmount, totalSpent) {
      if (!budgetAmount || budgetAmount <= 0) {
        clearBudgetUI();
        return;
      }
      
      const pct = (totalSpent / budgetAmount) * 100;
      const pctClamped = Math.min(Math.round(pct), 999);
      const widthPct = Math.min(pctClamped, 100);
      const remaining = Math.max(0, budgetAmount - totalSpent);
      
      // Update progress bar
      elements.budgetProgressBar.style.width = widthPct + "%";
      elements.budgetProgressBar.textContent = `${pctClamped}%`;
      elements.budgetProgressBar.className = "progress-bar";
      
      // Set color based on percentage
      if (pct >= 100) {
        elements.budgetProgressBar.classList.add("bg-danger");
      } else if (pct >= 80) {
        elements.budgetProgressBar.classList.add("bg-warning");
      } else {
        elements.budgetProgressBar.classList.add("bg-success");
      }
      
      // Update text displays
      elements.budgetStatusText.innerHTML = `
        <i class="fas fa-wallet"></i> Budget: ‚Çπ${budgetAmount.toFixed(2)}  
        | <i class="fas fa-money-bill-wave"></i> Spent: ‚Çπ${totalSpent.toFixed(2)}
      `;
      
      elements.budgetSpent.textContent = `Spent: ‚Çπ${totalSpent.toFixed(2)}`;
      elements.budgetRemaining.textContent = `Remaining: ‚Çπ${remaining.toFixed(2)}`;
      elements.budgetPercentage.textContent = `${pctClamped}%`;
      
      // Update alerts
      elements.budgetAlerts.innerHTML = "";
      elements.analyticsBadge.innerHTML = "";
      
      if (pct >= 100) {
        const over = (totalSpent - budgetAmount);
        elements.budgetAlerts.innerHTML = `
          <div class="budget-alert" style="background: linear-gradient(135deg, rgba(239,68,68,0.2) 0%, rgba(220,38,38,0.2) 100%); border: 2px solid var(--danger); color: var(--danger);">
            <i class="fas fa-exclamation-triangle"></i> 
            <strong>Budget Exceeded!</strong> You spent ‚Çπ${over.toFixed(2)} over the limit.
          </div>
        `;
        elements.analyticsBadge.innerHTML = `
          <span class="badge badge-danger">
            <i class="fas fa-exclamation-triangle"></i> Over budget: ‚Çπ${over.toFixed(2)}
          </span>
        `;
      } else if (pct >= 80) {
        elements.budgetAlerts.innerHTML = `
          <div class="budget-alert" style="background: linear-gradient(135deg, rgba(245,158,11,0.2) 0%, rgba(217,119,6,0.2) 100%); border: 2px solid var(--warning); color: var(--warning);">
            <i class="fas fa-exclamation-circle"></i> 
            <strong>Warning!</strong> You're at ${Math.round(pct)}% of your budget. Be careful!
          </div>
        `;
        elements.analyticsBadge.innerHTML = `
          <span class="badge badge-warning">
            <i class="fas fa-exclamation-circle"></i> Usage: ${Math.round(pct)}% of budget
          </span>
        `;
      } else {
        elements.analyticsBadge.innerHTML = `
          <span class="badge badge-success">
            <i class="fas fa-check-circle"></i> Usage: ${Math.round(pct)}% of budget
          </span>
        `;
      }
    }

    // Budget event listeners
    elements.saveBudgetBtn?.addEventListener("click", async () => {
      const val = parseFloat(elements.budgetInput.value);
      if (!val || val <= 0) {
        showMessage("‚ùå Please enter a valid budget amount", 2000);
        return;
      }
      await saveBudgetToServer(val);
    });

    elements.resetBudgetBtn?.addEventListener("click", async () => {
      if (!currentUserUid) return;
      
      if (!confirm("Are you sure you want to reset/delete your budget?")) return;
      
      try {
        showLoading("Resetting budget...");
        const res = await fetch(`${BASE_URL}/setBudget`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ 
            uid: currentUserUid, 
            amount: 0, 
            reset: true 
          })
        });
        
        const r = await res.json();
        
        if (res.ok) {
          showMessage(r.message || "‚úÖ Budget reset successfully");
          clearBudgetUI();
        } else {
          showMessage(r.message || "‚ùå Reset failed");
        }
      } catch(err) { 
        console.error(err); 
        showMessage("‚ùå Network error. Please try again.", 2000);
      } finally {
        hideLoading();
      }
    });

    // ==================== ENHANCED DATA LOADING & RENDERING ====================
    async function loadData() {
      if (!currentUserUid) return;
      
      try {
        showLoading("Loading your expenses...");
        const res = await fetch(`${BASE_URL}/users?uid=${currentUserUid}`);
        
        if (!res.ok) throw new Error("Failed to fetch users");
        const users = await res.json();
        
        if (!Array.isArray(users) || users.length === 0) {
          clearExpensesUI();
          elements.analyticsContainer.style.display = "none";
          const bRes = await fetch(`${BASE_URL}/getBudget?uid=${currentUserUid}`);
          
          if (bRes.ok) {
            const b = await bRes.json();
            if (b && b.amount) {
              updateBudgetUI(parseFloat(b.amount), 0);
            }
          }
          return;
        }

        renderExpenses(users);
        renderCharts(users);
        elements.analyticsContainer.style.display = "block";
        
        // Fetch and update budget
        const bRes = await fetch(`${BASE_URL}/getBudget?uid=${currentUserUid}`);
        if (bRes.ok) {
          const b = await bRes.json();
          if (b && b.amount && parseFloat(b.amount) > 0) {
            let totalAmount = 0;
            users.forEach(u => totalAmount += parseFloat(u.amount) || 0);
            updateBudgetUI(parseFloat(b.amount), totalAmount);
          } else {
            clearBudgetUI();
          }
        }
      } catch(err) { 
        console.error(err); 
        showErrorUI();
      } finally {
        hideLoading();
      }
    }

    function clearExpensesUI() {
      elements.expensesContainer.innerHTML = `
        <div class="card">
          <div class="card-body text-center py-5">
            <i class="fas fa-receipt" style="font-size: 3rem; color: var(--text-muted); margin-bottom: 20px;"></i>
            <h5 style="color: var(--text-light);">No expenses yet</h5>
            <p class="text-muted">Add your first expense above!</p>
          </div>
        </div>
      `;
    }

    function showErrorUI() {
      elements.expensesContainer.innerHTML = `
        <div class="card">
          <div class="card-body text-center py-5">
            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--danger); margin-bottom: 20px;"></i>
            <h5 style="color: var(--danger);">Failed to load expenses</h5>
            <p class="text-muted">Please check your connection and try again</p>
            <button class="btn btn-primary mt-3" onclick="loadData()">
              <i class="fas fa-redo"></i> Retry
            </button>
          </div>
        </div>
      `;
    }

    function renderExpenses(users) {
      let totalAmount = 0;
      users.forEach(u => totalAmount += parseFloat(u.amount) || 0);
      
      // Mobile view (cards)
      if (window.innerWidth < 768) {
        let mobileHtml = `
          <div class="card slide-up">
            <div class="card-header">
              <h5 class="mb-0"><i class="fas fa-receipt"></i> Your Expenses</h5>
            </div>
            <div class="card-body">
              <div class="row g-3">
        `;
        
        users.forEach((u, i) => {
          const amount = parseFloat(u.amount).toFixed(2);
          const date = new Date(u.date).toLocaleDateString('en-IN', {
            day: '2-digit',
            month: 'short',
            year: 'numeric'
          });
          
          mobileHtml += `
            <div class="col-12">
              <div class="expense-card">
                <div class="card-body">
                  <div class="expense-title">${u.name}</div>
                  
                  <div class="expense-meta">
                    <span class="expense-amount">‚Çπ${amount}</span>
                    <span class="expense-type">${u.type}</span>
                  </div>
                  
                  <div class="expense-description">
                    <i class="fas fa-file-alt"></i> ${u.description}
                  </div>
                  
                  <div class="expense-date">
                    <i class="fas fa-calendar"></i> ${date}
                  </div>
                  
                  <div class="expense-actions">
                    <button class="btn btn-warning btn-sm" onclick="editExpense('${u._id}')">
                      <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="btn btn-info btn-sm" onclick="viewHistory('${u._id}')">
                      <i class="fas fa-history"></i> History
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="deleteExpense('${u._id}','${u.name}')">
                      <i class="fas fa-trash"></i> Delete
                    </button>
                  </div>
                </div>
              </div>
            </div>
          `;
        });
        
        mobileHtml += `
              </div>
              
              <!-- Total Summary -->
              <div class="card mt-4" style="background: var(--gradient); color: white; border: none;">
                <div class="card-body text-center">
                  <h5 class="mb-1">
                    <i class="fas fa-calculator"></i> Total Expenses
                  </h5>
                  <h3 class="mb-0" style="font-weight: 800;">‚Çπ${totalAmount.toFixed(2)}</h3>
                </div>
              </div>
            </div>
          </div>
        `;
        
        elements.expensesContainer.innerHTML = mobileHtml;
      } else {
        // Desktop view (table)
        let desktopHtml = `
          <div class="card slide-up">
            <div class="card-header">
              <h5 class="mb-0"><i class="fas fa-receipt"></i> Expense History</h5>
            </div>
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table table-hover mb-0">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Name</th>
                      <th>Amount</th>
                      <th>Type</th>
                      <th>Description</th>
                      <th>Date</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
        `;
        
        users.forEach((u, i) => {
          desktopHtml += `
            <tr>
              <td>${i + 1}</td>
              <td><strong>${u.name}</strong></td>
              <td><span class="expense-amount">‚Çπ${parseFloat(u.amount).toFixed(2)}</span></td>
              <td><span class="badge badge-info">${u.type}</span></td>
              <td>${u.description}</td>
              <td>${u.date}</td>
              <td>
                <div class="btn-group">
                  <button class="btn btn-warning btn-sm me-1" onclick="editExpense('${u._id}')" title="Edit">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-info btn-sm me-1" onclick="viewHistory('${u._id}')" title="History">
                    <i class="fas fa-history"></i>
                  </button>
                  <button class="btn btn-danger btn-sm" onclick="deleteExpense('${u._id}','${u.name}')" title="Delete">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          `;
        });
        
        desktopHtml += `
                  </tbody>
                </table>
              </div>
              
              <!-- Total Row -->
              <div class="p-4" style="background: var(--gradient); color: white; border-radius: 0 0 16px 16px;">
                <div class="row align-items-center">
                  <div class="col-md-8">
                    <h5 class="mb-0"><i class="fas fa-calculator"></i> Total Expenses</h5>
                  </div>
                  <div class="col-md-4 text-end">
                    <h3 class="mb-0" style="font-weight: 800;">‚Çπ${totalAmount.toFixed(2)}</h3>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
        
        elements.expensesContainer.innerHTML = desktopHtml;
      }
    }

    // ==================== ENHANCED EDIT & DELETE ====================
    window.editExpense = async function(id) {
      try {
        showLoading("Loading expense details...");
        const res = await fetch(`${BASE_URL}/user/${id}`);
        
        if (!res.ok) throw new Error("Failed to fetch user");
        const user = await res.json();
        
        document.getElementById("name").value = user.name;
        document.getElementById("amount").value = user.amount;
        document.getElementById("type").value = user.type;
        document.getElementById("description").value = user.description;
        document.getElementById("date").value = user.date;
        elements.editId.value = id;
        
        setupEditCancelButton();
        showMessage("‚úè Edit mode enabled. Make your changes and click Confirm.", 3000);
        
        // Scroll to form
        document.getElementById('expenseFormContainer').scrollIntoView({ 
          behavior: 'smooth' 
        });
      } catch(err) { 
        console.error(err); 
        showMessage("‚ùå Failed to load expense for editing.", 2500);
      } finally {
        hideLoading();
      }
    }

    window.deleteExpense = async function(id, name) {
      if (!confirm(`Are you sure you want to delete "${name}"?\nThis action cannot be undone.`)) return;
      
      try {
        showLoading("Deleting expense...");
        const res = await fetch(`${BASE_URL}/delete/${id}`, { 
          method: "DELETE" 
        });
        
        const r = await res.json();
        
        if (res.ok) {
          showMessage("‚úÖ Expense deleted successfully");
          await loadData();
          await fetchBudget();
        } else {
          showMessage(r.message || "‚ùå Delete failed", 2000);
        }
      } catch(err) { 
        console.error(err); 
        showMessage("‚ùå Network error. Please try again.", 2000);
      } finally {
        hideLoading();
      }
    }

    // ==================== ENHANCED HISTORY FUNCTIONS ====================
    window.viewHistory = async function(expenseId) {
      try {
        showLoading("Loading history...");
        const res = await fetch(`${BASE_URL}/user/${expenseId}`);
        
        if (!res.ok) throw new Error("Failed to fetch expense");
        const expense = await res.json();
        
        let historyHtml = `
          <div class="mb-4">
            <h4><i class="fas fa-file-invoice-dollar"></i> ${expense.name}</h4>
            <p><strong>Current Amount:</strong> ‚Çπ${parseFloat(expense.amount).toFixed(2)}</p>
            <p><strong>Created:</strong> ${new Date(expense.createdAt).toLocaleString()}</p>
          </div>
        `;
        
        if (expense.editHistory && expense.editHistory.length > 0) {
          historyHtml += `
            <h5><i class="fas fa-history"></i> Edit History</h5>
            <div class="table-responsive">
              <table class="history-table">
                <thead>
                  <tr>
                    <th>Editor</th>
                    <th>Date & Time</th>
                    <th>Changes Made</th>
                  </tr>
                </thead>
                <tbody>
          `;
          
          expense.editHistory.forEach(edit => {
            const changes = [];
            if (edit.before.name !== edit.after.name) {
              changes.push(`<i class="fas fa-tag"></i> Name: "${edit.before.name}" ‚Üí "${edit.after.name}"`);
            }
            if (edit.before.amount !== edit.after.amount) {
              changes.push(`<i class="fas fa-rupee-sign"></i> Amount: ‚Çπ${edit.before.amount} ‚Üí ‚Çπ${edit.after.amount}`);
            }
            if (edit.before.type !== edit.after.type) {
              changes.push(`<i class="fas fa-credit-card"></i> Type: ${edit.before.type} ‚Üí ${edit.after.type}`);
            }
            if (edit.before.description !== edit.after.description) {
              changes.push(`<i class="fas fa-file-alt"></i> Description: "${edit.before.description}" ‚Üí "${edit.after.description}"`);
            }
            if (edit.before.date !== edit.after.date) {
              changes.push(`<i class="fas fa-calendar"></i> Date: ${edit.before.date} ‚Üí ${edit.after.date}`);
            }
            
            historyHtml += `
              <tr>
                <td><strong><i class="fas fa-user"></i> ${edit.editorName}</strong></td>
                <td>${new Date(edit.date).toLocaleString()}</td>
                <td class="changes-list">
                  ${changes.map(change => `<div>${change}</div>`).join('')}
                </td>
              </tr>
            `;
          });
          
          historyHtml += `</tbody></table></div>`;
        } else {
          historyHtml += `
            <div class="text-center py-4">
              <i class="fas fa-history" style="font-size: 3rem; color: var(--text-muted);"></i>
              <p class="text-muted mt-3">No edit history available for this expense.</p>
            </div>
          `;
        }
        
        elements.historyContent.innerHTML = historyHtml;
        elements.historyModal.style.display = "block";
      } catch(err) {
        console.error(err);
        elements.historyContent.innerHTML = `
          <div class="text-center py-4">
            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--danger);"></i>
            <p class="text-danger mt-3">Failed to load history. Please try again.</p>
          </div>
        `;
      } finally {
        hideLoading();
      }
    }

    async function showHistory() {
      try {
        showLoading("Loading complete history...");
        const res = await fetch(`${BASE_URL}/users?uid=${currentUserUid}`);
        
        if (!res.ok) throw new Error("Failed to fetch expenses");
        const expenses = await res.json();
        
        let historyHtml = `<h4><i class="fas fa-history"></i> Complete Edit History</h4>`;
        
        const expensesWithHistory = expenses.filter(exp => exp.editHistory && exp.editHistory.length > 0);
        
        if (expensesWithHistory.length === 0) {
          historyHtml += `
            <div class="text-center py-4">
              <i class="fas fa-history" style="font-size: 3rem; color: var(--text-muted);"></i>
              <p class="text-muted mt-3">No edit history available yet.</p>
            </div>
          `;
        } else {
          historyHtml += `<div class="row g-3">`;
          
          expensesWithHistory.forEach(expense => {
            const lastEdit = expense.editHistory[expense.editHistory.length - 1];
            const lastEditTime = new Date(lastEdit.date).toLocaleDateString();
            
            historyHtml += `
              <div class="col-md-6">
                <div class="card" style="background: var(--card-bg); border: 1px solid var(--border);">
                  <div class="card-body">
                    <h6>${expense.name}</h6>
                    <p class="small text-muted">
                      <i class="fas fa-rupee-sign"></i> ‚Çπ${parseFloat(expense.amount).toFixed(2)} 
                      | <i class="fas fa-edit"></i> ${expense.editCount || 0} edits
                    </p>
                    <p class="small text-muted">
                      <i class="fas fa-calendar"></i> Last edited: ${lastEditTime}
                    </p>
                    <button class="btn btn-sm btn-info w-100 mt-2" onclick="viewHistory('${expense._id}')">
                      <i class="fas fa-eye"></i> View Details
                    </button>
                  </div>
                </div>
              </div>
            `;
          });
          
          historyHtml += `</div>`;
        }
        
        elements.historyContent.innerHTML = historyHtml;
        elements.historyModal.style.display = "block";
      } catch(err) {
        console.error(err);
        elements.historyContent.innerHTML = `
          <div class="text-center py-4">
            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--danger);"></i>
            <p class="text-danger mt-3">Failed to load history. Please try again.</p>
          </div>
        `;
      } finally {
        hideLoading();
      }
    }

    // ==================== ENHANCED CHART RENDERING ====================
    function renderCharts(users) {
      const dates = {};
      const types = {};

      let totalAmount = 0;
      users.forEach(u => {
        const date = u.date || "Unknown";
        const amount = parseFloat(u.amount) || 0;
        totalAmount += amount;
        dates[date] = (dates[date] || 0) + amount;
        types[u.type] = (types[u.type] || 0) + amount;
      });

      // FIXED: Proper pie chart calculation WITHOUT Over Budget category
      // We'll show Over Budget as a separate metric, not in pie chart
      const pieCategories = Object.keys(types);
      const pieValues = Object.values(types);

      // FIXED: Consistent colors for each category
      const categoryColors = {
        'Card': '#00bcd4',      // Cyan
        'Cash': '#ff9800',      // Orange
        'Gpay/Paytm': '#8bc34a', // Green
        'Other': '#e91e63'      // Pink
      };

      // Line Chart
      const lineCtx = document.getElementById('lineChart').getContext('2d');
      if (window.lineChartInstance) window.lineChartInstance.destroy();
      
      window.lineChartInstance = new Chart(lineCtx, {
        type: 'line',
        data: {
          labels: Object.keys(dates),
          datasets: [{
            label: 'Daily Expenses',
            data: Object.values(dates),
            borderColor: 'var(--primary)',
            backgroundColor: 'rgba(0,188,212,0.2)',
            borderWidth: 3,
            fill: true,
            tension: 0.3,
            pointBackgroundColor: 'var(--primary)',
            pointBorderColor: 'white',
            pointBorderWidth: 2
          }]
        },
        options: { 
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: {
                color: 'var(--text-light)',
                font: { size: 12 }
              }
            },
            tooltip: {
              backgroundColor: 'var(--card-bg)',
              titleColor: 'var(--text)',
              bodyColor: 'var(--text)',
              borderColor: 'var(--primary)',
              borderWidth: 1
            }
          },
          scales: { 
            y: { 
              beginAtZero: true,
              ticks: { 
                color: 'var(--text-light)',
                callback: function(value) {
                  return '‚Çπ' + value;
                }
              },
              grid: { 
                color: 'var(--border)',
                drawBorder: false
              }
            },
            x: {
              ticks: { 
                color: 'var(--text-light)',
                maxRotation: 45
              },
              grid: { 
                color: 'var(--border)',
                drawBorder: false
              }
            }
          }
        }
      });

      // Pie Chart - FIXED: No Over Budget category
      const pieCtx = document.getElementById('pieChart').getContext('2d');
      if (window.pieChartInstance) window.pieChartInstance.destroy();

      const bgColors = pieCategories.map(label => {
        return categoryColors[label] || `hsl(${Math.random() * 360}, 70%, 60%)`;
      });

      window.pieChartInstance = new Chart(pieCtx, {
        type: 'pie',
        data: {
          labels: pieCategories,
          datasets: [{
            data: pieValues,
            backgroundColor: bgColors,
            borderColor: 'var(--card-bg)',
            borderWidth: 3,
            hoverOffset: 15
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                color: 'var(--text-light)',
                padding: 20,
                font: { 
                  size: 12,
                  weight: '600'
                },
                usePointStyle: true,
                pointStyle: 'circle'
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const label = context.label || '';
                  const value = context.raw || 0;
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = Math.round((value / total) * 100);
                  return `${label}: ‚Çπ${value.toFixed(2)} (${percentage}%)`;
                }
              },
              backgroundColor: 'var(--card-bg)',
              titleColor: 'var(--text)',
              bodyColor: 'var(--text)',
              borderColor: 'var(--primary)',
              borderWidth: 1
            }
          }
        }
      });

      // Update analytics badge with OVER BUDGET info if applicable
      if (currentBudgetAmount > 0) {
        const usagePercent = Math.round((totalAmount / currentBudgetAmount) * 100);
        if (totalAmount > currentBudgetAmount) {
          const overAmount = totalAmount - currentBudgetAmount;
          elements.analyticsBadge.innerHTML = `
            <div class="alert alert-danger" style="background: linear-gradient(135deg, rgba(239,68,68,0.1) 0%, rgba(220,38,38,0.1) 100%); border: 2px solid var(--danger); color: var(--danger);">
              <i class="fas fa-exclamation-triangle"></i>
              <strong>Over Budget:</strong> ‚Çπ${overAmount.toFixed(2)} (${usagePercent}% used)
            </div>
          `;
        } else {
          elements.analyticsBadge.innerHTML = `
            <div class="alert alert-success" style="background: linear-gradient(135deg, rgba(16,185,129,0.1) 0%, rgba(5,150,105,0.1) 100%); border: 2px solid var(--success); color: var(--success);">
              <i class="fas fa-check-circle"></i>
              <strong>Budget Status:</strong> ${usagePercent}% used (‚Çπ${totalAmount.toFixed(2)} of ‚Çπ${currentBudgetAmount.toFixed(2)})
            </div>
          `;
        }
      } else {
        elements.analyticsBadge.innerHTML = `
          <div class="alert alert-info" style="background: rgba(0,188,212,0.1); border: 2px solid var(--primary); color: var(--primary);">
            <i class="fas fa-chart-pie"></i>
            <strong>Total Expenses:</strong> ‚Çπ${totalAmount.toFixed(2)}
          </div>
        `;
      }
    }

    // ==================== EVENT LISTENERS ====================
    elements.aboutLink?.addEventListener("click", e => {
      e.preventDefault();
      elements.aboutModal.style.display = "block";
    });

    elements.closeAbout?.addEventListener("click", () => {
      elements.aboutModal.style.display = "none";
    });

    elements.historyLink?.addEventListener("click", e => {
      e.preventDefault();
      showHistory();
    });

    elements.closeHistory?.addEventListener("click", () => {
      elements.historyModal.style.display = "none";
    });

    elements.themeToggle?.addEventListener("click", cycleTheme);

    window.addEventListener("click", e => {
      if (e.target == elements.aboutModal) elements.aboutModal.style.display = "none";
      if (e.target == elements.historyModal) elements.historyModal.style.display = "none";
    });

    // Handle window resize for responsive layout
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        if (currentUserUid) {
          loadData();
        }
      }, 300);
    });

    // ==================== INITIALIZATION ====================
    function initializeApp() {
      // Start typing animation
      typeWriterHeader();
      
      // Initialize theme
      initTheme();
      
      // Initialize Firebase
      initializeFirebase();
      
      // Set today's date in form
      const today = new Date().toISOString().split('T')[0];
      const dateInput = document.getElementById('date');
      if (dateInput) {
        dateInput.value = today;
        dateInput.max = today; // Prevent future dates
      }
      
      // Initialize form cancel button listener
      elements.editId?.addEventListener('input', setupEditCancelButton);
    }

    // Start the app
    initializeApp();

    // Service Worker registration
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("/sw.js")
          .then(() => console.log("Service Worker registered"))
          .catch(err => console.error("SW failed", err));
      });
    }
    </script>

    <footer>
      <div class="footer-content">
        <p style="margin:0;">Developed with <i class="fas fa-heart" style="color: var(--danger);"></i> by <strong class="blinking-name">ALPHA DEVELOPERS</strong></p>
        <p style="margin:10px 0 0 0;">
          <a href="mailto:santhoshgowtham777@gmail.com">
            <i class="fas fa-envelope"></i> santhoshgowtham777@gmail.com
          </a>
        </p>
        <p style="margin:10px 0 0 0;">&copy; 2025 E-TRAX. All rights reserved.</p>
      </div>
    </footer>
  </body>
</html>
