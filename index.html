
<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- ================= BASIC SEO ================= -->
  <title>E-TRAX | Smart Expense Tracker for Daily Budget Management</title>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <meta name="description" content="E-TRAX is a smart expense tracker to manage daily income and expenses with analytics, Firebase login, secure cloud storage, and budget tracking." />
<meta name="keywords" content="expense tracker, expense tracker app, expense tracker web app, daily expense tracker, budget tracker, budget management app, money manager, personal finance tracker, finance management app, income and expense tracker, expense tracker for students, expense tracker for professionals, smart expense tracker, E-TRAX expense tracker, AlphaPrime expense tracker, alphaprime.co.in">


  <meta name="author" content="AlphaPrime" />
  <meta name="robots" content="index, follow" />

  <!-- ================= CANONICAL ================= -->
  <link rel="canonical" href="https://www.alphaprime.co.in/" />

  <!-- ================= OPEN GRAPH ================= -->
  <meta property="og:title" content="E-TRAX | Smart Expense Tracker" />
  <meta property="og:description" content="Track your daily expenses, set budgets, and analyze spending with E-TRAX ‚Äì a secure smart expense tracker." />
  <meta property="og:url" content="https://www.alphaprime.co.in/" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://www.alphaprime.co.in/e.png" />

  <!-- ================= TWITTER CARD ================= -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="E-TRAX | Smart Expense Tracker" />
  <meta name="twitter:description" content="Manage daily expenses and budgets easily with E-TRAX." />
  <meta name="twitter:image" content="https://www.alphaprime.co.in/e.png" />

  <!-- ================= FAVICONS ================= ------------------------------------------------------------------------------>
  <link rel="icon" href="EtraxPub.jpg" type="image/png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">

<!-- /public/favicon.png          (512x512)
/public/apple-touch-icon.png (180x180) -->

  <!-- ================= PWA ================= -->
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#00bcd4" />

  <!-- ================= FONTS & CSS ================= -->
  <!-- <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"> -->
   <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- ================= JS LIBS ================= -->
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- ================= STRUCTURED DATA ================= -->
 <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "E-TRAX",
  "url": "https://www.alphaprime.co.in/",
  "logo": "https://www.alphaprime.co.in/logo.png"
}
</script>

  
<style>
:root {
  /* Professional Dark Blue Theme */
  --primary: #3b82f6;
  --primary-dark: #2563eb;
  --secondary: #f59e0b;
  --accent: #8b5cf6;
  --background: #0f172a;
  --card-bg: #1e293b;
  --text: #ffffff;
  --text-light: #e2e8f0;
  --text-muted: #94a3b8;
  --border: rgba(255,255,255,0.1);
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  --shadow: 0 10px 30px rgba(0,0,0,0.5);
  --gradient-blue: linear-gradient(135deg, #0f172a 0%, #1e40af 50%, #3b82f6 100%);
}

[data-theme="light"] {
  --primary: #2563eb;
  --primary-dark: #1d4ed8;
  --secondary: #dc2626;
  --background: #ffffff;
  --card-bg: #f8fafc;
  --text: #1e293b;
  --text-light: #334155;
  --text-muted: #64748b;
  --border: rgba(0,0,0,0.1);
  --success: #059669;
  --warning: #d97706;
  --danger: #dc2626;
  --shadow: 0 10px 30px rgba(0,0,0,0.08);
  --gradient-blue: linear-gradient(135deg, #ffffff 0%, #dbeafe 50%, #bfdbfe 100%);
}

[data-theme="professional"] {
  --primary: #3b82f6;
  --primary-dark: #2563eb;
  --secondary: #f59e0b;
  --background: #0f172a;
  --card-bg: #1e293b;
  --text: #ffffff;
  --text-light: #e2e8f0;
  --text-muted: #94a3b8;
  --border: rgba(255,255,255,0.15);
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  --shadow: 0 10px 30px rgba(0,0,0,0.6);
  --gradient-blue: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #3b82f6 100%);
}

* {
  box-sizing: border-box;
  transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
}

/* ========== TYPOGRAPHY ========== */
/* Headings - Professional & Responsive */
h1, h2, h3, h4, h5, h6,
.project-name,
.login-card h1,
.modal-content h2 {
  font-family: "Inter", sans-serif;
  font-weight: 700;
  line-height: 1.2;
  letter-spacing: -0.02em;
}

/* Desktop sizes */
h1 { font-size: 2.5rem; }
h2 { font-size: 2rem; }
h3 { font-size: 1.75rem; }
h4 { font-size: 1.5rem; }
h5 { font-size: 1.25rem; }
h6 { font-size: 1rem; }

/* Mobile sizes */
@media (max-width: 768px) {
  h1 { font-size: 2rem; }
  h2 { font-size: 1.75rem; }
  h3 { font-size: 1.5rem; }
  h4 { font-size: 1.25rem; }
  h5 { font-size: 1.1rem; }
  h6 { font-size: 1rem; }
}

/* Body text */
body {
  font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  font-weight: 400;
  line-height: 1.6;
  font-size: 16px;
}

/* Smaller text for mobile */
@media (max-width: 768px) {
  body {
    font-size: 15px;
  }
}

/* Buttons and navigation */
button,
.btn,
.nav-links a,
.form-control,
.form-select {
  font-family: "Inter", sans-serif;
  font-weight: 500;
  letter-spacing: 0.01em;
}

/* Card titles */
.card h5, .card h6 {
  font-family: "Inter", sans-serif;
  font-weight: 600;
}

/* ========== BACKGROUND ANIMATION ========== */
body {
  background-color: var(--background);
  color: var(--text);
  min-height: 100vh;
  margin: 0;
  position: relative;
  overflow-x: hidden;
}

/* Animated gradient background - 90% dark blue, 10% white effect */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--gradient-blue);
  background-size: 400% 400%;
  animation: gradientBG 15s ease infinite;
  z-index: -2;
  opacity: 0.9;
}

/* Subtle particle effect - white 10% effect */
body::after {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: 
    radial-gradient(circle at 20% 80%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.05) 0%, transparent 50%),
    radial-gradient(circle at 40% 40%, rgba(139, 92, 246, 0.08) 0%, transparent 50%);
  z-index: -1;
  animation: float 20s ease-in-out infinite;
}

@keyframes gradientBG {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

@keyframes float {
  0%, 100% { transform: translateY(0) rotate(0deg); }
  50% { transform: translateY(-20px) rotate(180deg); }
}

/* ========== LOGIN VIEW ========== */
.login-wrapper {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  padding: 20px;
  position: relative;
  overflow: hidden;
}

/* Enhanced login animation */
.login-wrapper::before {
  content: '';
  position: absolute;
  width: 300%;
  height: 300%;
  background: 
    radial-gradient(circle at 30% 70%, rgba(59, 130, 246, 0.15) 0%, transparent 40%),
    radial-gradient(circle at 70% 30%, rgba(255, 255, 255, 0.1) 0%, transparent 40%);
  animation: pulse 20s ease-in-out infinite alternate;
}

@keyframes pulse {
  0% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
  100% { transform: translate(-50%, -50%) scale(1.2) rotate(180deg); }
}

.login-card {
  width: 100%;
  max-width: 420px;
  background: rgba(30, 41, 59, 0.95);
  backdrop-filter: blur(20px);
  border-radius: 20px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 
    0 20px 40px rgba(0, 0, 0, 0.4),
    0 0 0 1px rgba(255, 255, 255, 0.05),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
  padding: 40px 30px;
  text-align: center;
  position: relative;
  z-index: 1;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.login-card:hover {
  transform: translateY(-5px);
  box-shadow: 
    0 25px 50px rgba(0, 0, 0, 0.5),
    0 0 0 1px rgba(255, 255, 255, 0.1),
    inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

.login-card h1 {
  background: linear-gradient(135deg, var(--primary), var(--accent));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 12px;
  font-size: 2.8rem;
  font-weight: 800;
}

.login-card p {
  color: var(--text-light);
  margin-bottom: 32px;
  font-size: 1.1rem;
  line-height: 1.5;
  font-weight: 400;
}

.google-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  width: 100%;
  background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
  color: #1e293b;
  border-radius: 12px;
  padding: 16px 24px;
  font-weight: 600;
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  font-size: 1rem;
  position: relative;
  overflow: hidden;
}

.google-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s ease;
}

.google-btn:hover::before {
  left: 100%;
}

.google-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
}

.google-btn:active {
  transform: translateY(0);
}

.google-btn img {
  width: 20px;
  height: 20px;
}

.small-note {
  color: var(--text-muted);
  font-size: 0.9rem;
  margin-top: 20px;
  line-height: 1.4;
  font-weight: 400;
}

/* ========== HEADER ========== */
header {
  display: none;
  background: rgba(30, 41, 59, 0.95);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
  padding: 16px 24px;
  position: sticky;
  top: 0;
  z-index: 1000;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

header.visible {
  display: block;
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 16px;
  max-width: 1400px;
  margin: 0 auto;
}

.brand-section {
  display: flex;
  align-items: center;
  gap: 16px;
}

.brand-section h1 {
  font-size: 1.8rem;
  background: linear-gradient(135deg, var(--primary), var(--accent));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin: 0;
  font-weight: 800;
}

.typing {
  font-size: 0.95rem;
  color: var(--secondary);
  font-weight: 500;
  min-height: 1.2rem;
  letter-spacing: 0.02em;
}

.header-controls {
  display: flex;
  align-items: center;
  gap: 20px;
}

#userNameDisplay {
  color: var(--text-light);
  font-weight: 600;
  font-size: 1rem;
  padding: 6px 12px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
  border: 1px solid var(--border);
}

.theme-toggle {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 10px 16px;
  color: var(--text-light);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.3s ease;
  font-weight: 500;
  font-size: 0.95rem;
}

.theme-toggle:hover {
  background: var(--primary);
  color: white;
  transform: translateY(-2px);
}

.nav-links {
  display: flex;
  align-items: center;
  gap: 12px;
}

.nav-links a {
  color: var(--text-light);
  text-decoration: none;
  font-weight: 500;
  transition: all 0.3s ease;
  position: relative;
  padding: 8px 16px;
  border-radius: 8px;
  font-size: 0.95rem;
  display: flex;
  align-items: center;
  gap: 6px;
}

.nav-links a:hover {
  color: var(--primary);
  background: rgba(59, 130, 246, 0.1);
}

#googleLogoutBtn {
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid var(--danger);
  color: var(--danger);
  font-weight: 500;
  border-radius: 10px;
  padding: 10px 20px;
  transition: all 0.3s ease;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 0.95rem;
}

#googleLogoutBtn:hover {
  background: var(--danger);
  color: white;
  transform: translateY(-2px);
}

/* ========== CARDS & CONTAINERS ========== */
.container {
  padding-top: 24px;
  padding-bottom: 24px;
  max-width: 1400px;
  margin: 0 auto;
}

.card {
  background: rgba(30, 41, 59, 0.95);
  backdrop-filter: blur(20px);
  border-radius: 16px;
  border: 1px solid var(--border);
  box-shadow: 
    0 10px 30px rgba(0, 0, 0, 0.4),
    0 0 0 1px rgba(255, 255, 255, 0.05);
  transition: all 0.3s ease;
  margin-bottom: 24px;
  color: var(--text);
  overflow: hidden;
}

.card:hover {
  transform: translateY(-4px);
  box-shadow: 
    0 20px 40px rgba(0, 0, 0, 0.5),
    0 0 0 1px rgba(255, 255, 255, 0.1);
}

.card-header {
  background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.05));
  border-bottom: 1px solid var(--border);
  padding: 20px 24px;
  border-radius: 16px 16px 0 0 !important;
  color: var(--primary);
  font-weight: 600;
  font-size: 1.1rem;
}

.card-body {
  padding: 24px;
}

/* ========== BUTTON STYLES ========== */
.btn {
  font-family: "Inter", sans-serif;
  font-weight: 500;
  border-radius: 10px;
  padding: 10px 20px;
  transition: all 0.3s ease;
  border: none;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: white;
  border: 1px solid var(--primary-dark);
}

.btn-primary:hover {
  background: linear-gradient(135deg, var(--primary-dark), #1d4ed8);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(37, 99, 235, 0.3);
}

.btn-outline-danger {
  background: transparent;
  color: var(--danger);
  border: 1px solid var(--danger);
}

.btn-outline-danger:hover {
  background: var(--danger);
  color: white;
  transform: translateY(-2px);
}

.btn-success {
  background: linear-gradient(135deg, var(--success), #059669);
  color: white;
  border: 1px solid #059669;
}

.btn-warning {
  background: linear-gradient(135deg, var(--warning), #d97706);
  color: white;
  border: 1px solid #d97706;
}

.btn-danger {
  background: linear-gradient(135deg, var(--danger), #dc2626);
  color: white;
  border: 1px solid #dc2626;
}

.btn-info {
  background: linear-gradient(135deg, #0ea5e9, #0284c7);
  color: white;
  border: 1px solid #0284c7;
}

/* Button hover effects */
.btn-success:hover,
.btn-warning:hover,
.btn-danger:hover,
.btn-info:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
}

.btn-sm {
  padding: 8px 16px;
  font-size: 0.85rem;
  border-radius: 8px;
}

/* Form controls */
.form-control,
.form-select {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid var(--border);
  color: var(--text);
  border-radius: 10px;
  padding: 12px 16px;
  font-size: 1rem;
  transition: all 0.3s ease;
}

.form-control:focus,
.form-select:focus {
  background: rgba(255, 255, 255, 0.08);
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
  outline: none;
}

/* ========== RESPONSIVE DESIGN ========== */
/* Tablet */
@media (max-width: 992px) {
  .header-content {
    flex-direction: column;
    text-align: center;
    gap: 12px;
  }
  
  .brand-section {
    flex-direction: column;
    gap: 8px;
  }
  
  .header-controls {
    flex-direction: column;
    gap: 12px;
  }
  
  .nav-links {
    flex-wrap: wrap;
    justify-content: center;
  }
  
  .login-card {
    padding: 30px 24px;
    max-width: 380px;
  }
}

/* Mobile */
@media (max-width: 768px) {
  .container {
    padding-left: 16px;
    padding-right: 16px;
  }
  
  header {
    padding: 12px 16px;
  }
  
  .brand-section h1 {
    font-size: 1.5rem;
  }
  
  .typing {
    font-size: 0.85rem;
  }
  
  .header-controls {
    width: 100%;
    justify-content: center;
  }
  
  .nav-links a,
  #googleLogoutBtn,
  .theme-toggle {
    font-size: 0.9rem;
    padding: 8px 12px;
  }
  
  .theme-toggle span {
    display: none;
  }
  
  .theme-toggle {
    padding: 8px;
  }
  
  .card-header,
  .card-body {
    padding: 16px;
  }
  
  .login-card {
    padding: 24px 20px;
    max-width: 340px;
  }
  
  .login-card h1 {
    font-size: 2.2rem;
  }
  
  .login-card p {
    font-size: 1rem;
  }
  
  .google-btn {
    padding: 14px 20px;
    font-size: 0.95rem;
  }
  
  .btn {
    padding: 8px 16px;
    font-size: 0.9rem;
  }
  
  .form-control,
  .form-select {
    padding: 10px 12px;
    font-size: 0.9rem;
  }
}

/* Small Mobile */
@media (max-width: 480px) {
  .login-card {
    padding: 20px 16px;
    max-width: 300px;
  }
  
  .login-card h1 {
    font-size: 2rem;
  }
  
  .nav-links {
    gap: 8px;
  }
  
  .nav-links a,
  #googleLogoutBtn {
    padding: 6px 10px;
    font-size: 0.85rem;
  }
  
  .card-body {
    padding: 12px;
  }
  
  .form-control,
  .form-select {
    padding: 10px 12px;
    font-size: 0.85rem;
  }
  
  .btn {
    padding: 8px 14px;
    font-size: 0.85rem;
  }
}

/* ========== TABLES - RESPONSIVE ========== */
.table-container {
  margin-top: 20px;
  padding: 20px;
  background: rgba(30, 41, 59, 0.95);
  backdrop-filter: blur(20px);
  border-radius: 16px;
  border: 1px solid var(--border);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
  overflow: hidden;
}

/* Desktop table */
@media (min-width: 768px) {
  table {
    font-size: 0.95rem;
  }
  
  table thead th {
    font-size: 0.95rem;
    padding: 16px 12px;
  }
  
  table tbody td {
    padding: 14px 12px;
    font-size: 0.9rem;
  }
}

/* Mobile table adjustments */
@media (max-width: 767px) {
  .table-container {
    padding: 16px;
  }
  
  .table-responsive {
    font-size: 0.85rem;
  }
  
  .table thead th {
    font-size: 0.85rem;
    padding: 12px 8px;
  }
  
  .table tbody td {
    padding: 10px 8px;
    font-size: 0.8rem;
  }
  
  .btn-group .btn {
    padding: 6px 8px;
    font-size: 0.8rem;
    margin: 2px;
  }
}

/* ========== MOBILE EXPENSE CARDS ========== */
@media (max-width: 767px) {
  .expense-card .card-body {
    padding: 16px;
  }
  
  .expense-details {
    font-size: 0.85rem;
  }
  
  .expense-card .card-title {
    font-size: 1.1rem;
  }
  
  .btn-sm {
    padding: 6px 10px;
    font-size: 0.8rem;
  }
}

/* ========== FIXED WIDTH FOR TABLES ON MOBILE ========== */
@media (max-width: 768px) {
  .table-container {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  .table {
    min-width: 600px; /* Ensures table doesn't break on small screens */
  }
}

/* ========== UTILITY CLASSES ========== */
.high-contrast-text {
  color: var(--text) !important;
  font-weight: 600 !important;
}

.text-muted {
  color: var(--text-muted) !important;
  font-weight: 400;
}

/* Smooth transitions */
a, button, input, select {
  transition: all 0.2s ease;
}

/* Focus states */
button:focus,
input:focus,
select:focus {
  outline: 2px solid var(--primary);
  outline-offset: 2px;
}

/* Loading animation enhancement */
.loading {
  border-width: 2px;
  border-top-color: var(--primary);
}

/* Modal responsiveness */
@media (max-width: 768px) {
  .modal-content {
    padding: 20px;
    margin: 20px;
    width: calc(100% - 40px);
  }
  
  .modal-content h2 {
    font-size: 1.5rem;
  }
}

/* Badge styles */
.badge {
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 600;
  display: inline-block;
}

.badge-info {
  background: rgba(59, 130, 246, 0.2);
  color: var(--primary);
  border: 1px solid rgba(59, 130, 246, 0.3);
}

.badge-success {
  background: rgba(16, 185, 129, 0.2);
  color: var(--success);
  border: 1px solid rgba(16, 185, 129, 0.3);
}

.badge-warning {
  background: rgba(245, 158, 11, 0.2);
  color: var(--warning);
  border: 1px solid rgba(245, 158, 11, 0.3);
}

.badge-danger {
  background: rgba(239, 68, 68, 0.2);
  color: var(--danger);
  border: 1px solid rgba(239, 68, 68, 0.3);
}
</style>

</head>

<body>

<!-- LOGIN VIEW -->
<div id="loginView" class="login-wrapper">
  <iframe
  src="https://lottie.host/embed/fef0dd87-b7ca-430b-b7ff-f306c934d368/WKpgmIC1iO.lottie"
  style="
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    border: none;
    z-index: 0;
    opacity: 0.6;
    pointer-events: none;
  ">
</iframe>

  <div class="login-card">
    <h1>E-TRAX</h1>
    <p>Track expenses ‚Äî smarter. Sign in with Google to continue.</p>

    <button id="googleLoginBtn" class="google-btn" aria-label="Login with Google">
      <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google">
      <span>Sign in with Google</span>
    </button>

    <div class="small-note">We only use Google to authenticate you ‚Äî no payment info required.</div>
    <div style="margin-top:14px;">
      <small style="color:var(--text-muted)">Developed by <strong style="color:var(--primary)">ALPHA DEVELOPERS </strong></small>
    </div>
  </div>
</div>

<!-- HEADER -->
<header id="mainHeader">
  <div class="header-content">
    <div class="brand-section">
      <h1 class="project-name">E-TRAX</h1>
      <div class="typing" id="typingHeader"></div>
    </div>
    
    <div class="header-controls">
      <div id="userNameDisplay"></div>
      
      <button class="theme-toggle" id="themeToggle">
        <i class="fas fa-palette"></i>
        <span>Theme</span>
      </button>
      
      <nav class="nav-links">
        <a href="https://whatsapp.com/channel/0029Va5gnd0CcW4xKICHcb0k" target="_blank" rel="noopener">
          <i class="fas fa-phone"></i> Contact
        </a>
        <a href="#" id="aboutLink">
          <i class="fas fa-info-circle"></i> About
        </a>
        <a href="#" id="historyLink">
          <i class="fas fa-history"></i> History
        </a>
        <button id="googleLogoutBtn">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </nav>
    </div>
  </div>
</header>

<!-- MAIN CONTAINER -->
<div class="container my-3">
  <!-- BUDGET CARD -->
  <div id="budgetCard" class="card">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h5 style="margin:0;color:var(--warning);">Budget Limit</h5>
          <small class="text-muted">Set a monthly/total budget for your expenses</small>
        </div>
        <div>
          <button id="resetBudgetBtn" class="btn btn-outline-danger btn-sm">Reset Budget</button>
        </div>
      </div>

      <div class="row g-2 mb-3">
        <div class="col-md-5">
          <input type="number" id="budgetInput" class="form-control" placeholder="Enter budget amount (e.g. 5000)">
        </div>
        <div class="col-md-3">
          <button id="saveBudgetBtn" class="btn btn-primary w-100">Save Budget</button>
        </div>
        <div class="col-md-4 text-end">
          <div id="budgetStatusText" style="font-weight:600;color:var(--text);">No budget set</div>
        </div>
      </div>

      <div id="budgetBar" class="mb-2">
        <div id="budgetProgress" class="progress" style="width:100%">
          <div id="budgetProgressBar" class="progress-bar" role="progressbar" style="width:0%"></div>
        </div>
      </div>

      <div id="budgetAlerts" style="min-height:22px;"></div>
    </div>
  </div>

  <!-- EXPENSE FORM -->
  <div id="expenseFormContainer" style="display:none;">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-plus-circle"></i> Add New Expense</h5>
      </div>
      <div class="card-body">
        <form id="expenseForm" class="row g-3">
          <input type="hidden" id="editId">
          <div class="col-md-6">
            <label for="name" class="form-label">Name</label>
            <input type="text" id="name" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label for="amount" class="form-label">Amount</label>
            <input type="number" id="amount" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label for="type" class="form-label">Type</label>
            <select id="type" class="form-select" required>
              <option value="">Choose one...</option>
              <option value="Card">Card</option>
              <option value="Cash">Cash</option>
              <option value="Gpay/Paytm">Gpay/Paytm</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="col-md-6">
            <label for="description" class="form-label">Description</label>
            <input type="text" id="description" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label for="date" class="form-label">Date</label>
            <input type="date" id="date" class="form-control" required>
          </div>
          <div class="col-12 d-flex justify-content-between mt-3">
            <button type="reset" class="btn btn-danger">
              <i class="fas fa-times"></i> Clear
            </button>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-check"></i> Confirm
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- TABLE -->
  <div id="tableContainer" class="table-responsive"></div>

  <!-- ANALYTICS -->
  <div id="analyticsContainer" class="my-4" style="display:none;">
    <div class="table-container">
      <h4 class="text-center" style="color:var(--primary);">üìä Expense Analytics</h4>
      <div class="row">
        <div class="col-md-6">
          <div class="chart-container">
            <canvas id="lineChart"></canvas>
          </div>
        </div>
        <div class="col-md-6">
          <div class="chart-container">
            <canvas id="pieChart"></canvas>
          </div>
          <div id="analyticsBadge" class="text-center mt-3"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ABOUT MODAL -->
<div id="aboutModal" class="modal-overlay">
  <div class="modal-content">
    <h2>About E-TRAX</h2>
    <p><strong>E-TRAX</strong> helps you <strong>track your daily expenses</strong> and manage your budget efficiently.</p>
    <h4>üí° Purpose</h4>
    <p>Record, categorize, and analyze your spending patterns easily.</p>
    <h4>‚öôÔ∏è How It Works</h4>
    <ul>
      <li>Add expenses with name, amount, and date.</li>
      <li>View and edit them anytime.</li>
      <li>Check total expenses instantly.</li>
      <li>See visual analytics of your spending trends.</li>
      <li>Set budget limits and track your spending against them.</li>
      <li>Track complete edit history with user details.</li>
    </ul>
    <div style="text-align:center;">
      <button id="closeAbout" class="btn btn-primary">Close</button>
    </div>
  </div>
</div>

<!-- HISTORY MODAL -->
<div id="historyModal" class="modal-overlay">
  <div class="modal-content">
    <h2>üìù Edit History</h2>
    <div id="historyContent">
      <p>Loading history...</p>
    </div>
    <div style="text-align:center; margin-top: 20px;">
      <button id="closeHistory" class="btn btn-primary">Close</button>
    </div>
  </div>
</div>

<!-- MESSAGE BOX -->
<div id="msgBox"></div>

<script>
// BASE URL
const BASE_URL = window.location.hostname.includes("localhost")
  ? "http://localhost:3000"
  : "https://sandy-backend2-0.onrender.com";

// Firebase will be initialized after fetching config from backend
let auth = null;
let currentUserUid = null;
let currentUserName = null;

// Theme Management
const themes = ['dark', 'light', 'professional'];
let currentThemeIndex = 0;

function initTheme() {
  const savedTheme = localStorage.getItem('theme') || 'dark';
  currentThemeIndex = themes.indexOf(savedTheme);
  applyTheme(savedTheme);
}

function applyTheme(theme) {
  document.documentElement.setAttribute('data-theme', theme);
  localStorage.setItem('theme', theme);
}

function cycleTheme() {
  currentThemeIndex = (currentThemeIndex + 1) % themes.length;
  applyTheme(themes[currentThemeIndex]);
}

// Initialize Firebase securely
async function initializeFirebase() {
  try { 
    const response = await fetch(`${BASE_URL}/firebase-config`);
    const firebaseConfig = await response.json();
    
    if (!firebaseConfig.apiKey) {
      throw new Error('Firebase config not available');
    }
    
    firebase.initializeApp(firebaseConfig);
    auth = firebase.auth();
    console.log('Firebase initialized securely');
    
    // Now initialize auth state listener
    setupAuthListener();
    
  } catch (error) {
    console.error('Failed to initialize Firebase:', error);
    showMessage('‚ùå Failed to initialize app. Please refresh.', 5000);
  }
}

// Setup auth state listener after Firebase is initialized
function setupAuthListener() {
  auth.onAuthStateChanged(user => {
    if (user) {
      currentUserUid = user.uid;
      currentUserName = user.displayName || "User";
      toggleLoginState(true);
      loadData();
      userNameDisplay.textContent = currentUserName;
      fetchBudget();
    } else {
      currentUserUid = null;
      currentUserName = null;
      toggleLoginState(false);
      tableContainer.innerHTML = "<p class='text-muted'>Login to view your expenses</p>";
      analyticsContainer.style.display = "none";
      userNameDisplay.textContent = "";
      clearBudgetUI();
    }
  });
}

// Elements
const loginBtn = document.getElementById("googleLoginBtn");
const logoutBtn = document.getElementById("googleLogoutBtn");
const loginView = document.getElementById("loginView");
const mainHeader = document.getElementById("mainHeader");
const expenseFormContainer = document.getElementById("expenseFormContainer");
const tableContainer = document.getElementById("tableContainer");
const msgBox = document.getElementById("msgBox");
const userNameDisplay = document.getElementById("userNameDisplay");
const analyticsContainer = document.getElementById("analyticsContainer");
const themeToggle = document.getElementById("themeToggle");
const historyLink = document.getElementById("historyLink");
const historyModal = document.getElementById("historyModal");
const closeHistory = document.getElementById("closeHistory");
const historyContent = document.getElementById("historyContent");

// Budget elements
const budgetCard = document.getElementById("budgetCard");
const budgetInput = document.getElementById("budgetInput");
const saveBudgetBtn = document.getElementById("saveBudgetBtn");
const resetBudgetBtn = document.getElementById("resetBudgetBtn");
const budgetProgressBar = document.getElementById("budgetProgressBar");
const budgetStatusText = document.getElementById("budgetStatusText");
const budgetAlerts = document.getElementById("budgetAlerts");
const analyticsBadge = document.getElementById("analyticsBadge");

let currentBudgetAmount = 0;

// About modal
const aboutLink = document.getElementById("aboutLink");
const aboutModal = document.getElementById("aboutModal");
const closeAbout = document.getElementById("closeAbout");

// Event Listeners
aboutLink && aboutLink.addEventListener("click", e => { e.preventDefault(); aboutModal.style.display = "block"; });
closeAbout && closeAbout.addEventListener("click", () => { aboutModal.style.display = "none"; });
historyLink && historyLink.addEventListener("click", e => { e.preventDefault(); showHistory(); });
closeHistory && closeHistory.addEventListener("click", () => { historyModal.style.display = "none"; });
themeToggle && themeToggle.addEventListener("click", cycleTheme);

window.addEventListener("click", e => { 
  if(e.target == aboutModal) aboutModal.style.display="none";
  if(e.target == historyModal) historyModal.style.display="none";
});

// Initialize theme and Firebase
initTheme();
initializeFirebase();

// Message function
function showMessage(msg, duration=2000) {
  msgBox.innerText = msg;
  msgBox.style.display = "block";
  setTimeout(()=> msgBox.style.display="none", duration);
}

// Toggle login state
function toggleLoginState(isLoggedIn) {
  loginView.style.display = isLoggedIn ? "none" : "flex";
  mainHeader.classList.toggle('visible', isLoggedIn);
  expenseFormContainer.style.display = isLoggedIn ? "block" : "none";
  budgetCard.style.display = isLoggedIn ? "block" : "none";
}

// Login button
loginBtn.addEventListener("click", async () => {
  if (!auth) {
    showMessage(" Please wait...", 2000);
    return;
  }
  
  const provider = new firebase.auth.GoogleAuthProvider();
  try {
    const result = await auth.signInWithPopup(provider);
    currentUserUid = result.user.uid;
    currentUserName = result.user.displayName || "User";
    toggleLoginState(true);
    loadData();
    userNameDisplay.textContent = currentUserName;
    showMessage("‚úÖ Logged in successfully",2000);
    fetchBudget();
  } catch(err){ 
    console.error(err); 
    showMessage("‚ùå Login failed",2000); 
  }
});

// Logout button
logoutBtn && logoutBtn.addEventListener("click", async () => {
  if (!auth) return;
  
  try {
    await auth.signOut();
    currentUserUid = null;
    currentUserName = null;
    toggleLoginState(false);
    tableContainer.innerHTML = "<p class='text-muted'>Login to view your expenses</p>";
    analyticsContainer.style.display="none";
    userNameDisplay.textContent = "";
    clearBudgetUI();
    showMessage("‚úÖ Logged out successfully",2000);
  } catch(err){ 
    console.error(err); 
    showMessage("‚ùå Logout failed",2000); 
  }
});

// Typing animation
const headerText = "Track Your Expenses Smartly!";
const typingHeader = document.getElementById("typingHeader");
let headerIndex = 0;
function typeWriterHeader() {
  if(headerIndex < headerText.length){
    typingHeader.innerHTML += headerText.charAt(headerIndex);
    headerIndex++;
    setTimeout(typeWriterHeader,100);
  } else {
    setTimeout(()=>{ typingHeader.innerHTML=""; headerIndex=0; typeWriterHeader(); },2000);
  }
}
typeWriterHeader();

// Expense form handling
const form = document.getElementById("expenseForm");
const editId = document.getElementById("editId");
form && form.addEventListener("submit", async e=>{
  e.preventDefault();
  if(!currentUserUid) return;
  const data = {
    uid: currentUserUid,
    name: document.getElementById("name").value.trim(),
    amount: document.getElementById("amount").value.trim(),
    type: document.getElementById("type").value,
    description: document.getElementById("description").value.trim(),
    date: document.getElementById("date").value
  };
  try {
    const url = editId.value ? `${BASE_URL}/update/${editId.value}` : `${BASE_URL}/submit`;
    const method = editId.value ? "PUT" : "POST";
    // Add editor name when updating
    if (editId.value) {
      data.editorName = currentUserName;
    }
    const res = await fetch(url,{ method, headers:{ "Content-Type":"application/json" }, body:JSON.stringify(data)});
    const result = await res.json();
    showMessage(result.message);
    editId.value="";
    form.reset();
    await loadData();
    await fetchBudget();
  } catch(err){ console.error(err); showMessage("‚ùå Failed to submit/edit expense",2500);}
});

// Budget functions
async function saveBudgetToServer(amount){
  if(!currentUserUid) return;
  try {
    const res = await fetch(`${BASE_URL}/setBudget`, {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify({ uid: currentUserUid, amount: parseFloat(amount) || 0 })
    });
    const r = await res.json();
    if(res.ok) showMessage(r.message || "Budget saved");
    else showMessage(r.message || "Failed to save budget");
    await fetchBudget();
  } catch(err){ console.error(err); showMessage("‚ùå Failed to save budget",2000); }
}

async function fetchBudget(){
  if(!currentUserUid) return clearBudgetUI();
  try {
    const res = await fetch(`${BASE_URL}/getBudget?uid=${currentUserUid}`);
    if(!res.ok) return clearBudgetUI();
    const r = await res.json();
    if(!r || typeof r.amount === "undefined" || r.amount === 0){
      currentBudgetAmount = 0;
      clearBudgetUI();
      return;
    }
    currentBudgetAmount = parseFloat(r.amount) || 0;
    const expensesRes = await fetch(`${BASE_URL}/users?uid=${currentUserUid}`);
    const arr = await expensesRes.json();
    let totalAmount = 0;
    if(Array.isArray(arr)) arr.forEach(x=> totalAmount += parseFloat(x.amount)||0);
    updateBudgetUI(currentBudgetAmount, totalAmount);
    budgetInput && (budgetInput.value = currentBudgetAmount);
  } catch(err){ console.error(err); clearBudgetUI(); }
}

function clearBudgetUI(){
  if(budgetInput) budgetInput.value = "";
  if(budgetProgressBar) budgetProgressBar.style.width = "0%";
  if(budgetProgressBar) budgetProgressBar.className = "progress-bar";
  if(budgetStatusText) budgetStatusText.innerText = "No budget set";
  if(budgetAlerts) budgetAlerts.innerHTML = "";
  currentBudgetAmount = 0;
  if(analyticsBadge) analyticsBadge.innerText = "";
}

function updateBudgetUI(budgetAmount, totalSpent){
  if(!budgetAmount || budgetAmount <= 0){
    clearBudgetUI();
    return;
  }
  const pct = (totalSpent / budgetAmount) * 100;
  const pctClamped = Math.min(Math.round(pct), 999);
  const widthPct = Math.min(pctClamped, 100);
  budgetProgressBar.style.width = widthPct + "%";
  budgetProgressBar.innerText = `${pctClamped}%`;
  budgetProgressBar.className = "progress-bar";
  if(pct >= 100){
    budgetProgressBar.classList.add("bg-danger");
  } else if(pct >= 80){
    budgetProgressBar.classList.add("bg-warning");
  } else {
    budgetProgressBar.classList.add("bg-success");
  }
  budgetStatusText.innerText = `Budget: ‚Çπ${budgetAmount.toFixed(2)}  ‚Äî  Spent: ‚Çπ${totalSpent.toFixed(2)}`;
  budgetAlerts.innerHTML = "";
  analyticsBadge.innerText = "";
  if(pct >= 100){
    const over = (totalSpent - budgetAmount);
    budgetAlerts.innerHTML = `<div class="text-danger" style="font-weight:700;">üö® Budget exceeded! You spent ‚Çπ${over.toFixed(2)} over the limit.</div>`;
    analyticsBadge.innerHTML = `<span class="badge badge-danger">üö® Over budget: ‚Çπ${over.toFixed(2)}</span>`;
  } else if(pct >= 80){
    budgetAlerts.innerHTML = `<div class="text-warning" style="font-weight:700;">‚ö†Ô∏è You're at ${Math.round(pct)}% of your budget. Be careful!</div>`;
    analyticsBadge.innerHTML = `<span class="badge badge-warning">‚ö†Ô∏è Usage: ${Math.round(pct)}% of budget</span>`;
  } else {
    analyticsBadge.innerHTML = `<span class="badge badge-success">‚úÖ Usage: ${Math.round(pct)}% of budget</span>`;
  }
}

// Save/Reset event listeners
saveBudgetBtn && saveBudgetBtn.addEventListener("click", async () => {
  const val = parseFloat(budgetInput.value);
  if(!val || val <= 0){ showMessage("Enter valid budget amount"); return; }
  await saveBudgetToServer(val);
});
resetBudgetBtn && resetBudgetBtn.addEventListener("click", async () => {
  if(!currentUserUid) return;
  if(!confirm("Reset/delete your budget?")) return;
  try {
    const res = await fetch(`${BASE_URL}/setBudget`, {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify({ uid: currentUserUid, amount: 0, reset: true })
    });
    const r = await res.json();
    if(res.ok) showMessage(r.message || "Budget reset");
    else showMessage(r.message || "Reset failed");
    clearBudgetUI();
  } catch(err){ console.error(err); showMessage("‚ùå Reset failed",2000); }
});

// Load data and render table - MOBILE FRIENDLY VERSION
async function loadData(){
  if(!currentUserUid) return;
  try{
    const res = await fetch(`${BASE_URL}/users?uid=${currentUserUid}`);
    if(!res.ok) throw new Error("Failed to fetch users");
    const users = await res.json();
    if(!Array.isArray(users) || users.length===0){
      tableContainer.innerHTML = "<p class='text-muted'>No expenses yet. Add your first expense above!</p>";
      analyticsContainer.style.display="none";
      const bRes = await fetch(`${BASE_URL}/getBudget?uid=${currentUserUid}`);
      if(bRes.ok){
        const b = await bRes.json();
        if(b && b.amount) updateBudgetUI(parseFloat(b.amount), 0);
      }
      return;
    }

    let totalAmount = 0;
    
    // Mobile-friendly table design
    if (window.innerWidth < 768) {
      // MOBILE VIEW - Card layout
      let mobileHtml = `<div class="table-container">
        <h5 class="text-center mb-3" style="color:var(--primary);">Your Expenses</h5>
        <div class="row g-3">`;
      
      users.forEach((u,i)=>{
        totalAmount += parseFloat(u.amount) || 0;
        
        mobileHtml += `
          <div class="col-12">
            <div class="card expense-card" style="background:var(--card-bg); border:1px solid var(--border);">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <h6 class="card-title mb-0" style="color:var(--primary);">${u.name}</h6>
                  <span class="badge badge-info">${u.type}</span>
                </div>
                
                <div class="expense-details">
                  <div class="row small text-muted mb-2">
                    <div class="col-6">
                      <i class="fas fa-rupee-sign"></i> <strong>${parseFloat(u.amount).toFixed(2)}</strong>
                    </div>
                    <div class="col-6 text-end">
                      <i class="fas fa-calendar"></i> ${u.date}
                    </div>
                  </div>
                  
                  <p class="small mb-3" style="color:var(--text-light);">
                    <i class="fas fa-file-alt"></i> ${u.description}
                  </p>
                  
                  <div class="d-flex justify-content-between">
                    <button class="btn btn-warning btn-sm" onclick="editExpense('${u._id}')">
                      <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="btn btn-info btn-sm" onclick="viewHistory('${u._id}')">
                      <i class="fas fa-history"></i> 
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="deleteExpense('${u._id}','${u.name}')">
                      <i class="fas fa-trash"></i> 
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
      });

      mobileHtml += `
        </div>
        
        <!-- Total Summary -->
        <div class="card mt-3" style="background:var(--primary); color:white;">
          <div class="card-body text-center">
            <h6 class="mb-0">Total Expenses: ‚Çπ${totalAmount.toFixed(2)}</h6>
          </div>
        </div>
      </div>`;
      
      tableContainer.innerHTML = mobileHtml;
      
    } else {
      // DESKTOP VIEW - Table layout
      let desktopHtml = `<div class="table-container">
        <div class="table-responsive">
          <table class="table table-striped table-bordered">
            <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Amount</th>
                <th>Type</th>
                <th>Description</th>
                <th>Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>`;

      users.forEach((u,i)=>{
        totalAmount += parseFloat(u.amount) || 0;
        const actionBtn = `
          <div class="btn-group">
            <button class="btn btn-warning btn-sm me-1" onclick="editExpense('${u._id}')" title="Edit">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-info btn-sm me-1" onclick="viewHistory('${u._id}')" title="History">
              <i class="fas fa-history"></i>
            </button>
            <button class="btn btn-danger btn-sm" onclick="deleteExpense('${u._id}','${u.name}')" title="Delete">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        `;
        desktopHtml += `
          <tr>
            <td>${i+1}</td>
            <td>${u.name}</td>
            <td>‚Çπ${parseFloat(u.amount).toFixed(2)}</td>
            <td><span class="badge badge-info">${u.type}</span></td>
            <td>${u.description}</td>
            <td>${u.date}</td>
            <td>${actionBtn}</td>
          </tr>
        `;
      });

      desktopHtml += `
            </tbody>
          </table>
        </div>
        
        <!-- Total Row -->
        <div class="mt-3 p-3 rounded" style="background:var(--primary); color:white;">
          <div class="row">
            <div class="col-6 text-end">
              <strong>Total Expenses:</strong>
            </div>
            <div class="col-6">
              <strong>‚Çπ${totalAmount.toFixed(2)}</strong>
            </div>
          </div>
        </div>
      </div>`;
      
      tableContainer.innerHTML = desktopHtml;
    }

    analyticsContainer.style.display="block";
    renderCharts(users);

    const bRes = await fetch(`${BASE_URL}/getBudget?uid=${currentUserUid}`);
    if(bRes.ok){
      const b = await bRes.json();
      if(b && b.amount && parseFloat(b.amount) > 0){
        updateBudgetUI(parseFloat(b.amount), totalAmount);
      } else clearBudgetUI();
    }
  } catch(err){ 
    console.error(err); 
    tableContainer.innerHTML=`
      <div class="alert alert-danger text-center">
        <i class="fas fa-exclamation-triangle"></i> Failed to load expenses. Please try again.
      </div>
    `; 
  }
}

// Edit and Delete handlers
window.editExpense = async function(id){
  try{
    const res = await fetch(`${BASE_URL}/user/${id}`);
    if(!res.ok) throw new Error("Failed to fetch user");
    const user = await res.json();
    document.getElementById("name").value=user.name;
    document.getElementById("amount").value=user.amount;
    document.getElementById("type").value=user.type;
    document.getElementById("description").value=user.description;
    document.getElementById("date").value=user.date;
    editId.value=id;
    showMessage("‚úè Edit mode enabled - Make your changes and click Confirm",2000);
  } catch(err){ console.error(err); showMessage("‚ùå Failed to fetch expense for editing.",2500);}
}

window.deleteExpense = async function(id, name){
  if(!confirm(`Are you sure you want to delete expense "${name}"? This action cannot be undone.`)) return;
  try{
    const res = await fetch(`${BASE_URL}/delete/${id}`, { method: "DELETE" });
    const r = await res.json();
    if(res.ok){
      showMessage("‚úÖ Expense deleted successfully");
      await loadData();
      await fetchBudget();
    } else {
      showMessage(r.message || "Delete failed",2000);
    }
  } catch(err){ console.error(err); showMessage("‚ùå Failed to delete expense",2000); }
}

// History functions
window.viewHistory = async function(expenseId) {
  try {
    const res = await fetch(`${BASE_URL}/user/${expenseId}`);
    if(!res.ok) throw new Error("Failed to fetch expense");
    const expense = await res.json();
    
    let historyHtml = `
      <h4>Edit History for: <strong>${expense.name}</strong></h4>
      <p><strong>Created:</strong> ${new Date(expense.createdAt).toLocaleString()} by You</p>
    `;
    
    if (expense.editHistory && expense.editHistory.length > 0) {
      historyHtml += `
        <table class="history-table">
          <thead>
            <tr>
              <th>Editor</th>
              <th>Date & Time</th>
              <th>Changes Made</th>
            </tr>
          </thead>
          <tbody>
      `;
      
      expense.editHistory.forEach(edit => {
        const changes = [];
        if (edit.before.name !== edit.after.name) {
          changes.push(`Name: "${edit.before.name}" ‚Üí "${edit.after.name}"`);
        }
        if (edit.before.amount !== edit.after.amount) {
          changes.push(`Amount: ‚Çπ${edit.before.amount} ‚Üí ‚Çπ${edit.after.amount}`);
        }
        if (edit.before.type !== edit.after.type) {
          changes.push(`Type: ${edit.before.type} ‚Üí ${edit.after.type}`);
        }
        if (edit.before.description !== edit.after.description) {
          changes.push(`Description: "${edit.before.description}" ‚Üí "${edit.after.description}"`);
        }
        if (edit.before.date !== edit.after.date) {
          changes.push(`Date: ${edit.before.date} ‚Üí ${edit.after.date}`);
        }
        
        historyHtml += `
          <tr>
            <td><strong>${edit.editorName}</strong></td>
            <td>${new Date(edit.date).toLocaleString()}</td>
            <td class="changes-list">
              ${changes.map(change => `<div>${change}</div>`).join('')}
            </td>
          </tr>
        `;
      });
      
      historyHtml += `</tbody></table>`;
    } else {
      historyHtml += `<p class="text-muted">No edit history available for this expense.</p>`;
    }
    
    historyContent.innerHTML = historyHtml;
    historyModal.style.display = "block";
  } catch(err) {
    console.error(err);
    historyContent.innerHTML = "<p class='text-danger'>Failed to load history.</p>";
  }
}

async function showHistory() {
  try {
    const res = await fetch(`${BASE_URL}/users?uid=${currentUserUid}`);
    if(!res.ok) throw new Error("Failed to fetch expenses");
    const expenses = await res.json();
    
    let historyHtml = `<h4>Complete Edit History</h4>`;
    
    const expensesWithHistory = expenses.filter(exp => exp.editHistory && exp.editHistory.length > 0);
    
    if (expensesWithHistory.length === 0) {
      historyHtml += `<p class="text-muted">No edit history available yet.</p>`;
    } else {
      expensesWithHistory.forEach(expense => {
        historyHtml += `
          <div style="margin-bottom: 20px; padding: 15px; background: rgba(0,0,0,0.05); border-radius: 8px;">
            <h5>${expense.name} - ‚Çπ${parseFloat(expense.amount).toFixed(2)}</h5>
            <p><small>Total edits: ${expense.editCount || 0}</small></p>
            <button class="btn btn-sm btn-info" onclick="viewHistory('${expense._id}')">
              View Detailed History
            </button>
          </div>
        `;
      });
    }
    
    historyContent.innerHTML = historyHtml;
    historyModal.style.display = "block";
  } catch(err) {
    console.error(err);
    historyContent.innerHTML = "<p class='text-danger'>Failed to load history.</p>";
  }
}

// FIXED Charts renderer - Proper colors for each category
function renderCharts(users){
  const dates = {};
  const types = {};

  let totalAmount = 0;
  users.forEach(u=>{
    const date = u.date || "Unknown";
    const amount = parseFloat(u.amount) || 0;
    totalAmount += amount;
    dates[date] = (dates[date]||0)+amount;
    types[u.type] = (types[u.type]||0)+amount;
  });

  const overAmount = currentBudgetAmount && totalAmount > currentBudgetAmount ? (totalAmount - currentBudgetAmount) : 0;
  
  // Add over budget as separate category if exists
  if (overAmount > 0) {
    types['Over Budget'] = overAmount;
  }

  const lineCtx = document.getElementById('lineChart').getContext('2d');
  if(window.lineChartInstance) window.lineChartInstance.destroy();
  window.lineChartInstance = new Chart(lineCtx, {
    type: 'line',
    data: {
      labels: Object.keys(dates),
      datasets: [{
        label: 'Daily Expenses',
        data: Object.values(dates),
        borderColor: 'var(--primary)',
        backgroundColor: 'rgba(0,188,212,0.2)',
        fill: true,
        tension: 0.3
      }]
    },
    options: { 
      responsive: true,
      maintainAspectRatio: false,
      scales: { 
        y: { 
          beginAtZero:true,
          ticks: { color: 'var(--text-light)' },
          grid: { color: 'var(--border)' }
        },
        x: {
          ticks: { color: 'var(--text-light)' },
          grid: { color: 'var(--border)' }
        }
      },
      plugins: {
        legend: {
          labels: { color: 'var(--text-light)' }
        }
      }
    }
  });

  const pieCtx = document.getElementById('pieChart').getContext('2d');
  if(window.pieChartInstance) window.pieChartInstance.destroy();

  const labels = Object.keys(types);
  const values = Object.values(types);

  // FIXED: Proper color assignment for each category
  const categoryColors = {
    'Card': '#00bcd4',      // Cyan
    'Cash': '#ff9800',      // Orange
    'Gpay/Paytm': '#8bc34a', // Green
    'Other': '#e91e63',     // Pink
    'Over Budget': '#ff3b30' // Red
  };

  // Assign colors - use predefined or generate unique ones
  const bgColors = labels.map(label => {
    return categoryColors[label] || 
           `hsl(${Math.random() * 360}, 70%, 60%)`; // Random color for unknown categories
  });

  window.pieChartInstance = new Chart(pieCtx, {
    type: 'pie',
    data: {
      labels,
      datasets: [{
        data: values,
        backgroundColor: bgColors,
        borderColor: 'var(--card-bg)',
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            color: 'var(--text-light)',
            padding: 15,
            font: { size: 11 }
          }
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              const label = context.label || '';
              const value = context.raw || 0;
              const total = context.dataset.data.reduce((a, b) => a + b, 0);
              const percentage = Math.round((value / total) * 100);
              return `${label}: ‚Çπ${value.toFixed(2)} (${percentage}%)`;
            }
          }
        }
      }
    }
  });

  // Update analytics badge
  if(overAmount > 0){
    analyticsBadge.innerHTML = `<span class="badge badge-danger">üö® Over budget: ‚Çπ${overAmount.toFixed(2)}</span>`;
  } else if(currentBudgetAmount > 0) {
    const usagePercent = Math.round((totalAmount / currentBudgetAmount) * 100);
    analyticsBadge.innerHTML = `<span class="badge badge-success">‚úÖ Usage: ${usagePercent}% of budget</span>`;
  } else {
    analyticsBadge.innerHTML = `<span class="badge badge-info">üìä Total: ‚Çπ${totalAmount.toFixed(2)}</span>`;
  }
}

// Start the typing animation
typeWriterHeader();
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("/sw.js")
      .then(() => console.log("Service Worker registered"))
      .catch(err => console.error("SW failed", err));
  });
}
</script>
<footer>
  <div style="display:flex; flex-direction:column; align-items:center; gap:6px;">

    <div style="display:flex; gap:15px; font-size:0.75rem;">
      <a href="terms-conditions.html" id="termsLink">Terms & Conditions</a>
      <a href="privacy-policy.html" id="privacyLink">Privacy Policy</a>
    </div>

    <p style="margin:0;">
      Email: <a href="mailto:alphaprime.co.in@gmail.com">alphaprime.co.in@gmail.com</a>
    </p>

    <p style="margin:0;">&copy; 2025 E-TRAX. All rights reserved.</p>
  </div>
</footer>

</body>
</html>

